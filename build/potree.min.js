var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var e=0;return function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var e='undefined'!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return e?e.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var e,g=[];!(e=b.next()).done;)g.push(e.value);return g};
$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||'function'==typeof Object.create?Object.create:function(b){var e=function(){};e.prototype=b;return new e};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},e={};try{return e.__proto__=b,e.a}catch(g){}return!1};
$jscomp.setPrototypeOf='function'==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,e){b.__proto__=e;if(b.__proto__!==e)throw new TypeError(b+' is not extensible');return b}:null;
$jscomp.inherits=function(b,e){b.prototype=$jscomp.objectCreate(e.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var g=$jscomp.setPrototypeOf;g(b,e)}else for(g in e)if('prototype'!=g)if(Object.defineProperties){var h=Object.getOwnPropertyDescriptor(e,g);h&&Object.defineProperty(b,g,h)}else b[g]=e[g];b.superClass_=e.prototype};$jscomp.getGlobal=function(b){return'undefined'!=typeof window&&window===b?b:'undefined'!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.defineProperty=$jscomp.ASSUME_ES5||'function'==typeof Object.defineProperties?Object.defineProperty:function(b,e,g){b!=Array.prototype&&b!=Object.prototype&&(b[e]=g.value)};$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,e){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,'description',{configurable:!0,writable:!0,value:e})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function b(g){if(this instanceof b)throw new TypeError('Symbol is not a constructor');return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(g||'')+'_'+e++,g)}var e=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('Symbol.iterator'));'function'!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol('Symbol.asyncIterator'));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(b){if(!(b instanceof Object))throw new TypeError('Iterator result '+b+' is not an object');};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError('Generator is already running');this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(b){this.yieldResult=b};
$jscomp.generator.Context.prototype.throw_=function(b){this.abruptCompletion_={exception:b,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(b){this.abruptCompletion_={return:b};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(b){this.abruptCompletion_={jumpTo:b};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(b,e){this.nextAddress=e;return{value:b}};
$jscomp.generator.Context.prototype.yieldAll=function(b,e){b=$jscomp.makeIterator(b);var g=b.next();$jscomp.generator.ensureIteratorResultIsObject_(g);if(g.done)this.yieldResult=g.value,this.nextAddress=e;else return this.yieldAllIterator_=b,this.yield(g.value,e)};$jscomp.generator.Context.prototype.jumpTo=function(b){this.nextAddress=b};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(b,e){this.catchAddress_=b;void 0!=e&&(this.finallyAddress_=e)};$jscomp.generator.Context.prototype.setFinallyBlock=function(b){this.catchAddress_=0;this.finallyAddress_=b||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(b,e){this.nextAddress=b;this.catchAddress_=e||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(b){this.catchAddress_=b||0;b=this.abruptCompletion_.exception;this.abruptCompletion_=null;return b};$jscomp.generator.Context.prototype.enterFinallyBlock=function(b,e,g){g?this.finallyContexts_[g]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=b||0;this.finallyAddress_=e||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(b,e){e=this.finallyContexts_.splice(e||0)[0];if(e=this.abruptCompletion_=this.abruptCompletion_||e){if(e.isException)return this.jumpToErrorHandler_();void 0!=e.jumpTo&&this.finallyAddress_<e.jumpTo?(this.nextAddress=e.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=b};$jscomp.generator.Context.prototype.forIn=function(b){return new $jscomp.generator.Context.PropertyIterator(b)};
$jscomp.generator.Context.PropertyIterator=function(b){this.object_=b;this.properties_=[];for(var e in b)this.properties_.push(e);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var b=this.properties_.pop();if(b in this.object_)return b}return null};$jscomp.generator.Engine_=function(b){this.context_=new $jscomp.generator.Context;this.program_=b};
$jscomp.generator.Engine_.prototype.next_=function(b){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,b,this.context_.next_);this.context_.next_(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(b){this.context_.start_();var e=this.context_.yieldAllIterator_;if(e)return this.yieldAllStep_('return'in e?e['return']:function(b){return{value:b,done:!0}},b,this.context_.return);this.context_.return(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(b){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_['throw'],b,this.context_.next_);this.context_.throw_(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(b,e,g){try{var h=b.call(this.context_.yieldAllIterator_,e);$jscomp.generator.ensureIteratorResultIsObject_(h);if(!h.done)return this.context_.stop_(),h;var m=h.value}catch(v){return this.context_.yieldAllIterator_=null,this.context_.throw_(v),this.nextStep_()}this.context_.yieldAllIterator_=null;g.call(this.context_,m);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var b=this.program_(this.context_);if(b)return this.context_.stop_(),{value:b.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}this.context_.stop_();if(this.context_.abruptCompletion_){b=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(b.isException)throw b.exception;return{value:b.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(b){this.next=function(e){return b.next_(e)};this.throw=function(e){return b.throw_(e)};this.return=function(e){return b.return_(e)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(b,e){e=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(e));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(e,b.prototype);return e};
$jscomp.polyfill=function(b,e,g,h){if(e){g=$jscomp.global;b=b.split('.');for(h=0;h<b.length-1;h++){var m=b[h];m in g||(g[m]={});g=g[m]}b=b[b.length-1];h=g[b];e=e(h);e!=h&&null!=e&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:e})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill('Promise',function(b){function e(){this.batch_=null}function g(b){return b instanceof m?b:new m(function(e,w){e(b)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;e.prototype.asyncExecute=function(b){if(null==this.batch_){this.batch_=[];var e=this;this.asyncExecuteFunction(function(){e.executeBatch_()})}this.batch_.push(b)};var h=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(b){h(b,0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var b=
this.batch_;this.batch_=[];for(var e=0;e<b.length;++e){var w=b[e];b[e]=null;try{w()}catch(K){this.asyncThrow_(K)}}}this.batch_=null};e.prototype.asyncThrow_=function(b){this.asyncExecuteFunction(function(){throw b;})};var m=function(b){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var e=this.createResolveAndReject_();try{b(e.resolve,e.reject)}catch(w){e.reject(w)}};m.prototype.createResolveAndReject_=function(){function b(b){return function(h){w||(w=!0,b.call(e,h))}}var e=this,w=!1;
return{resolve:b(this.resolveTo_),reject:b(this.reject_)}};m.prototype.resolveTo_=function(b){if(b===this)this.reject_(new TypeError('A Promise cannot resolve to itself'));else if(b instanceof m)this.settleSameAsPromise_(b);else{a:switch(typeof b){case 'object':var e=null!=b;break a;case 'function':e=!0;break a;default:e=!1}e?this.resolveToNonPromiseObj_(b):this.fulfill_(b)}};m.prototype.resolveToNonPromiseObj_=function(b){var e=void 0;try{e=b.then}catch(w){this.reject_(w);return}'function'==typeof e?
this.settleSameAsThenable_(e,b):this.fulfill_(b)};m.prototype.reject_=function(b){this.settle_(2,b)};m.prototype.fulfill_=function(b){this.settle_(1,b)};m.prototype.settle_=function(b,e){if(0!=this.state_)throw Error('Cannot settle('+b+', '+e+'): Promise already settled in state'+this.state_);this.state_=b;this.result_=e;this.executeOnSettledCallbacks_()};m.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var b=0;b<this.onSettledCallbacks_.length;++b)v.asyncExecute(this.onSettledCallbacks_[b]);
this.onSettledCallbacks_=null}};var v=new e;m.prototype.settleSameAsPromise_=function(b){var e=this.createResolveAndReject_();b.callWhenSettled_(e.resolve,e.reject)};m.prototype.settleSameAsThenable_=function(b,e){var w=this.createResolveAndReject_();try{b.call(e,w.resolve,w.reject)}catch(K){w.reject(K)}};m.prototype.then=function(b,e){function w(b,e){return'function'==typeof b?function(e){try{h(b(e))}catch(W){g(W)}}:e}var h,g,v=new m(function(b,e){h=b;g=e});this.callWhenSettled_(w(b,h),w(e,g));return v};
m.prototype.catch=function(b){return this.then(void 0,b)};m.prototype.callWhenSettled_=function(b,e){function w(){switch(h.state_){case 1:b(h.result_);break;case 2:e(h.result_);break;default:throw Error('Unexpected state: '+h.state_);}}var h=this;null==this.onSettledCallbacks_?v.asyncExecute(w):this.onSettledCallbacks_.push(w)};m.resolve=g;m.reject=function(b){return new m(function(e,h){h(b)})};m.race=function(b){return new m(function(e,h){for(var w=$jscomp.makeIterator(b),m=w.next();!m.done;m=w.next())g(m.value).callWhenSettled_(e,
h)})};m.all=function(b){var e=$jscomp.makeIterator(b),h=e.next();return h.done?g([]):new m(function(b,w){function m(e){return function(h){K[e]=h;ba--;0==ba&&b(K)}}var K=[],ba=0;do K.push(void 0),ba++,g(h.value).callWhenSettled_(m(K.length-1),w),h=e.next();while(!h.done)})};return m},'es6','es3');
$jscomp.asyncExecutePromiseGenerator=function(b){function e(e){return b.next(e)}function g(e){return b.throw(e)}return new Promise(function(h,m){function v(b){b.done?h(b.value):Promise.resolve(b.value).then(e,g).then(v,m)}v(b.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(b){return $jscomp.asyncExecutePromiseGenerator(b())};$jscomp.asyncExecutePromiseGeneratorProgram=function(b){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b)))};
$jscomp.polyfill('Array.prototype.fill',function(b){return b?b:function(b,g,h){var e=this.length||0;0>g&&(g=Math.max(0,e+g));if(null==h||h>e)h=e;h=Number(h);0>h&&(h=Math.max(0,e+h));for(g=Number(g||0);g<h;g++)this[g]=b;return this}},'es6','es3');
$jscomp.iteratorFromArray=function(b,e){$jscomp.initSymbolIterator();b instanceof String&&(b+='');var g=0,h={next:function(){if(g<b.length){var m=g++;return{value:e(m,b[m]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill('Array.prototype.keys',function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},'es6','es3');
$jscomp.owns=function(b,e){return Object.prototype.hasOwnProperty.call(b,e)};$jscomp.assign='function'==typeof Object.assign?Object.assign:function(b,e){for(var g=1;g<arguments.length;g++){var h=arguments[g];if(h)for(var m in h)$jscomp.owns(h,m)&&(b[m]=h[m])}return b};$jscomp.polyfill('Object.assign',function(b){return b||$jscomp.assign},'es6','es3');
$jscomp.findInternal=function(b,e,g){b instanceof String&&(b=String(b));for(var h=b.length,m=0;m<h;m++){var v=b[m];if(e.call(g,v,m,b))return{i:m,v:v}}return{i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(b){return b?b:function(b,g){return $jscomp.findInternal(this,b,g).v}},'es6','es3');$jscomp.polyfill('Object.is',function(b){return b?b:function(b,g){return b===g?0!==b||1/b===1/g:b!==b&&g!==g}},'es6','es3');
$jscomp.polyfill('Array.prototype.includes',function(b){return b?b:function(b,g){var e=this;e instanceof String&&(e=String(e));var m=e.length;g=g||0;for(0>g&&(g=Math.max(g+m,0));g<m;g++){var v=e[g];if(v===b||Object.is(v,b))return!0}return!1}},'es7','es3');
$jscomp.checkStringArgs=function(b,e,g){if(null==b)throw new TypeError("The 'this' value for String.prototype."+g+' must not be null or undefined');if(e instanceof RegExp)throw new TypeError('First argument to String.prototype.'+g+' must not be a regular expression');return b+''};$jscomp.polyfill('String.prototype.includes',function(b){return b?b:function(b,g){return-1!==$jscomp.checkStringArgs(this,b,'includes').indexOf(b,g||0)}},'es6','es3');
$jscomp.checkEs6ConformanceViaProxy=function(){try{var b={},e=Object.create(new $jscomp.global.Proxy(b,{get:function(g,h,m){return g==b&&'q'==h&&m==e}}));return!0===e.q}catch(g){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.polyfill('WeakMap',function(b){function e(){if(!b||!Object.seal)return!1;try{var e=Object.seal({}),h=Object.seal({}),g=new b([[e,2],[h,3]]);if(2!=g.get(e)||3!=g.get(h))return!1;g.delete(e);g.set(h,4);return!g.has(e)&&4==g.get(h)}catch(qa){return!1}}function g(){}function h(b){if(!$jscomp.owns(b,v)){var e=new g;$jscomp.defineProperty(b,v,{value:e})}}function m(b){var e=Object[b];e&&(Object[b]=function(b){if(b instanceof g)return b;h(b);return e(b)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&
$jscomp.ES6_CONFORMANCE)return b}else if(e())return b;var v='$jscomp_hidden_'+Math.random();m('freeze');m('preventExtensions');m('seal');var D=0,N=function(b){this.id_=(D+=Math.random()+1).toString();if(b){b=$jscomp.makeIterator(b);for(var e;!(e=b.next()).done;)e=e.value,this.set(e[0],e[1])}};N.prototype.set=function(b,e){h(b);if(!$jscomp.owns(b,v))throw Error('WeakMap key fail: '+b);b[v][this.id_]=e;return this};N.prototype.get=function(b){return $jscomp.owns(b,v)?b[v][this.id_]:void 0};N.prototype.has=
function(b){return $jscomp.owns(b,v)&&$jscomp.owns(b[v],this.id_)};N.prototype.delete=function(b){return $jscomp.owns(b,v)&&$jscomp.owns(b[v],this.id_)?delete b[v][this.id_]:!1};return N},'es6','es3');$jscomp.MapEntry=function(){};
$jscomp.polyfill('Map',function(b){function e(){if($jscomp.ASSUME_NO_NATIVE_MAP||!b||'function'!=typeof b||!b.prototype.entries||'function'!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),h=new b($jscomp.makeIterator([[e,'s']]));if('s'!=h.get(e)||1!=h.size||h.get({x:4})||h.set({x:4},'t')!=h||2!=h.size)return!1;var g=h.entries(),m=g.next();if(m.done||m.value[0]!=e||'s'!=m.value[1])return!1;m=g.next();return m.done||4!=m.value[0].x||'t'!=m.value[1]||!g.next().done?!1:!0}catch(wa){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(e())return b;$jscomp.initSymbolIterator();var g=new WeakMap,h=function(b){this.data_={};this.head_=D();this.size=0;if(b){b=$jscomp.makeIterator(b);for(var e;!(e=b.next()).done;)e=e.value,this.set(e[0],e[1])}};h.prototype.set=function(b,e){b=0===b?0:b;var h=m(this,b);h.list||(h.list=this.data_[h.id]=[]);h.entry?h.entry.value=e:(h.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,
value:e},h.list.push(h.entry),this.head_.previous.next=h.entry,this.head_.previous=h.entry,this.size++);return this};h.prototype.delete=function(b){b=m(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};h.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=D();this.size=0};h.prototype.has=function(b){return!!m(this,b).entry};
h.prototype.get=function(b){return(b=m(this,b).entry)&&b.value};h.prototype.entries=function(){return v(this,function(b){return[b.key,b.value]})};h.prototype.keys=function(){return v(this,function(b){return b.key})};h.prototype.values=function(){return v(this,function(b){return b.value})};h.prototype.forEach=function(b,e){for(var h=this.entries(),g;!(g=h.next()).done;)g=g.value,b.call(e,g[1],g[0],this)};h.prototype[Symbol.iterator]=h.prototype.entries;var m=function(b,e){var h=e&&typeof e;'object'==
h||'function'==h?g.has(e)?h=g.get(e):(h=''+ ++N,g.set(e,h)):h='p_'+e;var m=b.data_[h];if(m&&$jscomp.owns(b.data_,h))for(b=0;b<m.length;b++){var v=m[b];if(e!==e&&v.key!==v.key||e===v.key)return{id:h,list:m,index:b,entry:v}}return{id:h,list:m,index:-1,entry:void 0}},v=function(b,e){var h=b.head_;return $jscomp.iteratorPrototype(function(){if(h){for(;h.head!=b.head_;)h=h.previous;for(;h.next!=h.head;)return h=h.next,{done:!1,value:e(h)};h=null}return{done:!0,value:void 0}})},D=function(){var b={};return b.previous=
b.next=b.head=b},N=0;return h},'es6','es3');$jscomp.polyfill('Number.isNaN',function(b){return b?b:function(b){return'number'===typeof b&&isNaN(b)}},'es6','es3');
$jscomp.polyfill('Set',function(b){function e(){if($jscomp.ASSUME_NO_NATIVE_SET||!b||'function'!=typeof b||!b.prototype.entries||'function'!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),g=new b($jscomp.makeIterator([e]));if(!g.has(e)||1!=g.size||g.add(e)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var v=g.entries(),D=v.next();if(D.done||D.value[0]!=e||D.value[1]!=e)return!1;D=v.next();return D.done||D.value[0]==e||4!=D.value[0].x||D.value[1]!=D.value[0]?!1:v.next().done}catch(N){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE)return b}else if(e())return b;$jscomp.initSymbolIterator();var g=function(b){this.map_=new Map;if(b){b=$jscomp.makeIterator(b);for(var e;!(e=b.next()).done;)this.add(e.value)}this.size=this.map_.size};g.prototype.add=function(b){b=0===b?0:b;this.map_.set(b,b);this.size=this.map_.size;return this};g.prototype.delete=function(b){b=this.map_.delete(b);this.size=this.map_.size;return b};g.prototype.clear=function(){this.map_.clear();
this.size=0};g.prototype.has=function(b){return this.map_.has(b)};g.prototype.entries=function(){return this.map_.entries()};g.prototype.values=function(){return this.map_.values()};g.prototype.keys=g.prototype.values;g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(b,e){var h=this;this.map_.forEach(function(g){return b.call(e,g,g,h)})};return g},'es6','es3');
(function(b,e){'object'===typeof exports&&'undefined'!==typeof module?e(exports):'function'===typeof define&&define.amd?define(['exports'],e):(b=b||self,e(b.Potree={}))})(this,function(b){function e(c,a,d){this.name=c;this.type=a;this.numElements=d;this.byteSize=this.numElements*this.type.size}function g(c){this.attributes=[];this.size=this.byteSize=0;if(null!=c)for(var a=0;a<c.length;a++){var d=e[c[a]];this.attributes.push(d);this.byteSize+=d.byteSize;this.size++}}function h(c,a,d,l,f){this.id=h.IDCount++;
this.name=c;this.index=parseInt(c.charAt(c.length-1));this.pcoGeometry=a;this.geometry=null;this.boundingBox=d;this.boundingSphere=d.getBoundingSphere(new THREE.Sphere);this.scale=l;this.offset=f;this.children={};this.numPoints=0;this.level=null;this.loaded=!1;this.oneTimeDisposeHandlers=[];this.baseLoaded=!1;c=new THREE.Vector3;a=this.boundingBox.clone();a.min.sub(this.pcoGeometry.boundingBox.getCenter(c));a.max.sub(this.pcoGeometry.boundingBox.getCenter(c));this.scale&&(a.min.multiplyScalar(1/this.scale),
a.max.multiplyScalar(1/this.scale));this.greyhoundBounds=a;this.greyhoundOffset=this.pcoGeometry.offset.clone().add(this.pcoGeometry.boundingBox.getSize(new THREE.Vector3).multiplyScalar(.5))}function m(c){this.version=c;var a=-1===c.indexOf('.')?c.length:c.indexOf('.');this.versionMajor=parseInt(c.substr(0,a));this.versionMinor=parseInt(c.substr(a+1));0===this.versionMinor.length&&(this.versionMinor=0)}function v(){}function D(c,a,d,l){l=void 0===l||0===l?1:l;c=c.slice(d,d+a.BYTES_PER_ELEMENT*l);
a=new a(c);if(void 0===l||1===l)return a[0];c=[];for(d=0;d<l;d++)c.push(a[d]);return c}function N(c){this.arraybuffer=c}function w(c){var a=this;this.arraybuffer=c;this.nextCB=null;this.dorr=function(c,l){a.nextCB=l;p.workerPool.runTask(A.LAS_LAZ,function(c){null!==a.nextCB&&(a.nextCB(c.data),a.nextCB=null)},c)}}function K(c){this.arraybuffer=c;this.determineVersion();if(12<this.version)throw Error('Only file versions <= 1.2 are supported at this time');this.determineFormat();if(void 0===Aa[this.formatId])throw Error('The point format ID is not supported');
this.loader=this.isCompressed?new w(this.arraybuffer):new N(this.arraybuffer)}function ba(c,a,d,l,f,b,k,u){this.arrayb=c;this.decoder=Aa[a];this.pointsCount=l;this.pointSize=d;this.scale=f;this.offset=b;this.mins=k;this.maxs=u}function qa(c){this.content=[];this.scoreFunction=c}function wa(c,a,d){var l=0,f=new Map(c.map(function(a){return[a,0]})),b=[],k=[],u=Infinity,r=za(c,a),q=r.frustums,n=r.camObjPositions;r=r.priorityQueue;var e=0,t=d.domElement.clientHeight;p.pointcloudTransformVersion||(p.pointcloudTransformVersion=
new Map);for(var h=p.pointcloudTransformVersion,g=0;g<c.length;g++)if(d=c[g],d.visible)if(d.updateMatrixWorld(),h.has(d)){var m=h.get(d);m.transform.equals(d.matrixWorld)||(m.number++,m.transform.copy(d.matrixWorld),d.dispatchEvent({type:'transformation_changed',target:d}))}else h.set(d,{number:0,transform:d.matrixWorld.clone()});for(;0<r.size();){m=r.pop();var z=m.node;g=m.parent;d=c[m.pointcloud];var v=z.getBoundingBox(),y=n[m.pointcloud],w=q[m.pointcloud].intersectsBox(v);v=d.maxLevel||Infinity;
var B=z.getLevel();w=(w=w&&!(f.get(d)+z.getNumPoints()>d.pointBudget))&&B<v;z.spacing?u=Math.min(u,z.spacing):z.geometryNode&&z.geometryNode.spacing&&(u=Math.min(u,z.geometryNode.spacing));if(w)for(l+=z.getNumPoints(),v=f.get(d),f.set(d,v+z.getNumPoints()),d.numVisibleNodes++,d.numVisiblePoints+=z.getNumPoints(),!z.isGeometryNode()||g&&!g.isTreeNode()||(z.isLoaded()&&e<p.maxNodesLoadGPUFrame?(z=d.toTreeNode(z,g),e++):k.push(z)),z.isTreeNode()&&(p.lru.touch(z.geometryNode),z.sceneNode.visible=!0,z.sceneNode.material=
d.material,b.push(z),d.visibleNodes.push(z),void 0===z._transformVersion&&(z._transformVersion=-1),g=h.get(d),z._transformVersion!==g.number&&(z.sceneNode.updateMatrix(),z.sceneNode.matrixWorld.multiplyMatrices(d.matrixWorld,z.sceneNode.matrix),z._transformVersion=g.number),d.showBoundingBox&&!z.boundingBoxNode&&z.getBoundingBox?(g=new THREE.Box3Helper(z.getBoundingBox()),g.matrixAutoUpdate=!1,d.boundingBoxNodes.push(g),z.boundingBoxNode=g,z.boundingBoxNode.matrix.copy(d.matrixWorld)):d.showBoundingBox?
(z.boundingBoxNode.visible=!0,z.boundingBoxNode.matrix.copy(d.matrixWorld)):!d.showBoundingBox&&z.boundingBoxNode&&(z.boundingBoxNode.visible=!1)),v=z.getChildren(),g=0;g<v.length;g++){B=v[g];var A=0;if(a.isPerspectiveCamera){var O=B.getBoundingSphere(new THREE.Sphere);w=O.center.distanceTo(y);O=O.radius;A=.5*t/(Math.tan(a.fov*Math.PI/180/2)*w)*O;if(A<d.minimumNodePixelSize)continue;0>w-O&&(A=Number.MAX_VALUE)}else O=B.getBoundingBox(),w=B.getBoundingSphere(new THREE.Sphere).center.distanceTo(y),
A=O.max.clone().sub(O.min).length()/w;r.push({pointcloud:m.pointcloud,node:B,parent:z,weight:A})}}c=c.filter(function(a){return a.generateDEM&&a.dem instanceof DEM});c=$jscomp.makeIterator(c);for(a=c.next();!a.done;a=c.next())d=a.value,a=d.visibleNodes.filter(function(a){return a.getLevel()<=p.maxDEMLevel}),d.dem.update(a);for(g=0;g<Math.min(p.maxNodesLoading,k.length);g++)k[g].load();return{visibleNodes:b,numVisiblePoints:l,lowestSpacing:u}}function ya(c,a,d){for(var l=wa(c,a,d),f=0;f<c.length;f++)c[f].updateMaterial(c[f].material,
c[f].visibleNodes,a,d),c[f].updateVisibleBounds();p.lru.freeMemory();return l}function za(c,a,d){d=[];for(var l=[],f=new qa(function(a){return 1/a.weight}),b=0;b<c.length;b++){var k=c[b];if(k.initialized()){k.numVisibleNodes=0;k.numVisiblePoints=0;k.deepestVisibleLevel=0;k.visibleNodes=[];k.visibleGeometry=[];a.updateMatrixWorld();var u=new THREE.Frustum,r=a.matrixWorldInverse,q=k.matrixWorld,n=a.clone();n.near=a.near;n.updateProjectionMatrix();n=a.projectionMatrix;r=(new THREE.Matrix4).multiply(n).multiply(r).multiply(q);
u.setFromMatrix(r);d.push(u);u=a.matrixWorld;q=(new THREE.Matrix4).getInverse(q);q=(new THREE.Matrix4).multiply(q).multiply(u);q=(new THREE.Vector3).setFromMatrixPosition(q);l.push(q);k.visible&&null!==k.root&&f.push({pointcloud:b,node:k.root,weight:Number.MAX_VALUE});k.root.isTreeNode()&&k.hideDescendants(k.root.sceneNode);for(q=0;q<k.boundingBoxNodes.length;q++)k.boundingBoxNodes[q].visible=!1}}return{frustums:d,camObjPositions:l,priorityQueue:f}}function W(c,a){if(a===THREE.RepeatWrapping)return c.REPEAT;
if(a===THREE.ClampToEdgeWrapping)return c.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return c.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return c.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return c.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return c.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return c.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return c.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return c.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return c.UNSIGNED_BYTE;
if(a===THREE.UnsignedShort4444Type)return c.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return c.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return c.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return c.BYTE;if(a===THREE.ShortType)return c.SHORT;if(a===THREE.UnsignedShortType)return c.UNSIGNED_SHORT;if(a===THREE.IntType)return c.INT;if(a===THREE.UnsignedIntType)return c.UNSIGNED_INT;if(a===THREE.FloatType)return c.FLOAT;if(a===THREE.HalfFloatType){var d=extensions.get('OES_texture_half_float');
if(null!==d)return d.HALF_FLOAT_OES}if(a===THREE.AlphaFormat)return c.ALPHA;if(a===THREE.RGBFormat)return c.RGB;if(a===THREE.RGBAFormat)return c.RGBA;if(a===THREE.LuminanceFormat)return c.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return c.LUMINANCE_ALPHA;if(a===THREE.DepthFormat)return c.DEPTH_COMPONENT;if(a===THREE.DepthStencilFormat)return c.DEPTH_STENCIL;if(a===THREE.AddEquation)return c.FUNC_ADD;if(a===THREE.SubtractEquation)return c.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return c.FUNC_REVERSE_SUBTRACT;
if(a===THREE.ZeroFactor)return c.ZERO;if(a===THREE.OneFactor)return c.ONE;if(a===THREE.SrcColorFactor)return c.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return c.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return c.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return c.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return c.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return c.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return c.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return c.ONE_MINUS_DST_COLOR;
if(a===THREE.SrcAlphaSaturateFactor)return c.SRC_ALPHA_SATURATE;if(a===THREE.RGB_S3TC_DXT1_Format||a===RGBA_S3TC_DXT1_Format||a===THREE.RGBA_S3TC_DXT3_Format||a===RGBA_S3TC_DXT5_Format)if(d=extensions.get('WEBGL_compressed_texture_s3tc'),null!==d){if(a===THREE.RGB_S3TC_DXT1_Format)return d.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return d.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return d.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return d.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(a===
THREE.RGB_PVRTC_4BPPV1_Format||a===THREE.RGB_PVRTC_2BPPV1_Format||a===THREE.RGBA_PVRTC_4BPPV1_Format||a===THREE.RGBA_PVRTC_2BPPV1_Format)if(d=extensions.get('WEBGL_compressed_texture_pvrtc'),null!==d){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(a===
THREE.RGB_ETC1_Format&&(d=extensions.get('WEBGL_compressed_texture_etc1'),null!==d))return d.COMPRESSED_RGB_ETC1_WEBGL;if(a===THREE.MinEquation||a===THREE.MaxEquation)if(d=extensions.get('EXT_blend_minmax'),null!==d){if(a===THREE.MinEquation)return d.MIN_EXT;if(a===THREE.MaxEquation)return d.MAX_EXT}return a===UnsignedInt248Type&&(d=extensions.get('WEBGL_depth_texture'),null!==d)?d.UNSIGNED_INT_24_8_WEBGL:0}var Ma=function(c){this.next=this.previous=null;this.node=c},X=function(){this.last=this.first=
null;this.items={};this.numPoints=this.elements=0};X.prototype.size=function(){return this.elements};X.prototype.contains=function(c){return null==this.items[c.id]};X.prototype.touch=function(c){if(c.loaded)if(null==this.items[c.id]){var a=new Ma(c);a.previous=this.last;this.last=a;null!==a.previous&&(a.previous.next=a);this.items[c.id]=a;this.elements++;null===this.first&&(this.first=a);this.numPoints+=c.numPoints}else a=this.items[c.id],null===a.previous?null!==a.next&&(this.first=a.next,this.first.previous=
null,a.previous=this.last,a.next=null,this.last=a,a.previous.next=a):null!==a.next&&(a.previous.next=a.next,a.next.previous=a.previous,a.previous=this.last,a.next=null,this.last=a,a.previous.next=a)};X.prototype.remove=function(c){var a=this.items[c.id];a&&(1===this.elements?this.last=this.first=null:(a.previous||(this.first=a.next,this.first.previous=null),a.next||(this.last=a.previous,this.last.next=null),a.previous&&a.next&&(a.previous.next=a.next,a.next.previous=a.previous)),delete this.items[c.id],
this.elements--,this.numPoints-=c.numPoints)};X.prototype.getLRUItem=function(){return null===this.first?null:this.first.node};X.prototype.toString=function(){for(var c='{ ',a=this.first;null!==a;)c+=a.node.id,null!==a.next&&(c+=', '),a=a.next;return c=c+'}'+('('+this.size()+')')};X.prototype.freeMemory=function(){if(!(1>=this.elements))for(;this.numPoints>p.pointLoadLimit;)this.disposeDescendants(this.first.node)};X.prototype.disposeDescendants=function(c){var a=[];for(a.push(c);0<a.length;){c=a.pop();
c.dispose();this.remove(c);for(var d in c.children)c.children.hasOwnProperty(d)&&c.children[d].loaded&&a.push(c.children[d])}};var A=function(){this.workers=[];for(var c=0;c<A.URLS.length;c++)this.workers.push([])};A.prototype.getWorker=function(c){return 0<this.workers[c].length?this.workers[c].pop():new Worker(p.workerPath+A.URLS[c])};A.prototype.returnWorker=function(c,a){this.workers[c].push(a)};A.prototype.runTask=function(c,a,d,l){var f=this,b=this.getWorker(c);b.onmessage=function(d){a(d);
f.returnWorker(c,b)};void 0!==l?b.postMessage(d,l):b.postMessage(d)};A.BINARY_DECODER=0;A.LAS_LAZ=1;A.LAS_DECODER=2;A.GREYHOUND=3;A.DEM=4;A.EPT_LAS_ZIP_DECODER=5;A.EPT_BINARY_DECODER=6;A.URLS='/workers/BinaryDecoderWorker.js /workers/LASLAZWorker.js /workers/LASDecoderWorker.js /workers/GreyhoundBinaryDecoderWorker.js /workers/DEMWorker.js /workers/EptLaszipDecoderWorker.js /workers/EptBinaryDecoderWorker.js'.split(' ');var p={debug:{},workerPath:function(){if(document.currentScript&&document.currentScript.src){var c=
(new URL(document.currentScript.src+'/..')).href;'/'===c.slice(-1)&&(c=c.slice(0,-1));return c}console.error('Potree: Was unable to find its script path using document.currentScript.');return''}(),maxNodesLoadGPUFrame:20,maxDEMLevel:0,maxNodesLoading:void 0!==navigator.hardwareConcurrency?navigator.hardwareConcurrency:4,pointLoadLimit:1E10,numNodesLoading:0,measureTimings:!1,workerPool:new A,lru:new X,pointcloudTransformVersion:void 0},y={POSITION_CARTESIAN:0,COLOR_PACKED:1,COLOR_FLOATS_1:2,COLOR_FLOATS_255:3,
NORMAL_FLOATS:4,FILLER:5,INTENSITY:6,CLASSIFICATION:7,NORMAL_SPHEREMAPPED:8,NORMAL_OCT16:9,NORMAL:10,RETURN_NUMBER:11,NUMBER_OF_RETURNS:12,SOURCE_ID:13,INDICES:14,SPACING:15},I={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,
size:8}},J=0;for(U in I)I[J]=I[U],J++;e.POSITION_CARTESIAN=new e(y.POSITION_CARTESIAN,I.DATA_TYPE_FLOAT,3);e.RGBA_PACKED=new e(y.COLOR_PACKED,I.DATA_TYPE_INT8,4);e.COLOR_PACKED=e.RGBA_PACKED;e.RGB_PACKED=new e(y.COLOR_PACKED,I.DATA_TYPE_INT8,3);e.NORMAL_FLOATS=new e(y.NORMAL_FLOATS,I.DATA_TYPE_FLOAT,3);e.FILLER_1B=new e(y.FILLER,I.DATA_TYPE_UINT8,1);e.INTENSITY=new e(y.INTENSITY,I.DATA_TYPE_UINT16,1);e.CLASSIFICATION=new e(y.CLASSIFICATION,I.DATA_TYPE_UINT8,1);e.NORMAL_SPHEREMAPPED=new e(y.NORMAL_SPHEREMAPPED,
I.DATA_TYPE_UINT8,2);e.NORMAL_OCT16=new e(y.NORMAL_OCT16,I.DATA_TYPE_UINT8,2);e.NORMAL=new e(y.NORMAL,I.DATA_TYPE_FLOAT,3);e.RETURN_NUMBER=new e(y.RETURN_NUMBER,I.DATA_TYPE_UINT8,1);e.NUMBER_OF_RETURNS=new e(y.NUMBER_OF_RETURNS,I.DATA_TYPE_UINT8,1);e.SOURCE_ID=new e(y.SOURCE_ID,I.DATA_TYPE_UINT8,1);e.INDICES=new e(y.INDICES,I.DATA_TYPE_UINT32,1);e.SPACING=new e(y.SPACING,I.DATA_TYPE_FLOAT,1);g.prototype.add=function(c){this.attributes.push(c);this.byteSize+=c.byteSize;this.size++};g.prototype.hasColors=
function(){for(var c in this.attributes)if(this.attributes[c].name===y.COLOR_PACKED)return!0;return!1};g.prototype.hasNormals=function(){for(var c in this.attributes){var a=this.attributes[c];if(a===e.NORMAL_SPHEREMAPPED||a===e.NORMAL_FLOATS||a===e.NORMAL||a===e.NORMAL_OCT16)return!0}return!1};var aa=function(c,a,d){this.name=c;this.box=a;this.tileSize=d;this.level=this.name.length-1;this.data=new Float32Array(d*d);this.data.fill(-Infinity);this.children=[];this.mipMap=[this.data];this.mipMapNeedsUpdate=
!0};aa.prototype.createMipMap=function(){this.mipMap=[this.data];for(var c=this.tileSize,a=parseInt(c/2),d=this.data;1<a;){for(var l=new Float32Array(a*a),f=0;f<a;f++)for(var b=0;b<a;b++){var k=d[2*f+2*b*c],u=d[2*f+2*b*c+c],r=d[2*f+1+2*b*c],q=d[2*f+1+2*b*c+c],n=$jscomp.makeIterator([0,0]),e=n.next().value;n=n.next().value;isFinite(k)&&(e+=k,n+=1);isFinite(u)&&(e+=u,n+=1);isFinite(r)&&(e+=r,n+=1);isFinite(q)&&(e+=q,n+=1);e/=n;l[f+b*a]=e}this.mipMap.push(l);d=l;c=a;a=parseInt(a/2)}this.mipMapNeedsUpdate=
!1};aa.prototype.uv=function(c){var a=this.box.getSize(new THREE.Vector3);return[(c.x-this.box.min.x)/a.x,(c.y-this.box.min.y)/a.y]};aa.prototype.heightAtMipMapLevel=function(c,a){c=this.uv(c);var d=parseInt(this.tileSize/parseInt(Math.pow(2,a))),l=this.mipMap[a],f=Math.min(c[0]*d,d-1),b=Math.min(c[1]*d,d-1);c=f%1;a=b%1;var k=$jscomp.makeIterator([Math.floor(f),Math.ceil(f)]);f=k.next().value;var u=k.next().value;b=$jscomp.makeIterator([Math.floor(b),Math.ceil(b)]);k=b.next().value;var r=b.next().value;
b=l[f+d*k];f=l[f+d*r];k=l[u+d*k];d=l[u+d*r];l=isFinite(b)?(1-c)*(1-a):0;u=isFinite(f)?(1-c)*a:0;r=isFinite(k)?c*(1-a):0;c=isFinite(d)?c*a:0;a=l+u+r+c;l/=a;u/=a;r/=a;c/=a;if(0===a)return null;a=0;isFinite(b)&&(a+=b*l);isFinite(f)&&(a+=f*u);isFinite(k)&&(a+=k*r);isFinite(d)&&(a+=d*c);return a};aa.prototype.height=function(c){for(var a=null,d=0;d<this.mipMap.length&&(a=this.heightAtMipMapLevel(c,d),null===a);d++);return a};aa.prototype.traverse=function(c,a){a=void 0===a?0:a;c(this,a);for(var d=$jscomp.makeIterator(this.children.filter(function(a){return void 0!==
a})),l=d.next();!l.done;l=d.next())l.value.traverse(c,a+1)};var ja=function(c){this.pointcloud=c;this.boundingBox=this.matrix=null;this.tileSize=64;this.root=null;this.version=0};ja.prototype.expandAndFindByBox=function(c,a){if(0===a)return[this.root];for(var d=[],l=[this.root];0<l.length;){var f=l.pop(),b=f.box.getSize(new THREE.Vector3),k=(c.min.x-f.box.min.x)/b.x,u=(c.min.y-f.box.min.y)/b.y,r=(c.max.x-f.box.max.x)/b.x,e=(c.max.y-f.box.max.y)/b.y;k=.5>k?0:1;u=.5>u?0:1;r=.5>r?0:1;e=.5>e?0:1;k=$jscomp.makeIterator(0===
k&&0===u&&1===r&&1===e?[0,1,2,3]:k===r&&u===e?[k<<1|u]:[k<<1|u,r<<1|e]);for(u=k.next();!u.done;u=k.next())u=u.value,void 0===f.children[u]&&(r=f.box.clone(),0<(u&2)?r.min.x+=b.x/2:r.max.x-=b.x/2,0<(u&1)?r.min.y+=b.y/2:r.max.y-=b.y/2,r=new aa(f.name+u,r,this.tileSize),f.children[u]=r),r=f.children[u],r.level<a?l.push(r):d.push(r)}return d};ja.prototype.childIndex=function(c){var a=$jscomp.makeIterator(c.map(function(a){return.5>a?0:1}));c=a.next().value;a=a.next().value;return c<<1|a};ja.prototype.height=
function(c){if(!this.root)return 0;for(var a=null,d=[this.root];;){var l=d[d.length-1],f=l.height(c);null!==f&&(a=f);f=l.uv(c);f=this.childIndex(f);if(l.children[f])d.push(l.children[f]);else break}return a+this.pointcloud.position.z};ja.prototype.update=function(c){null!==this.matrix&&this.matrix.equals(this.pointcloud.matrixWorld)||(this.matrix=this.pointcloud.matrixWorld.clone(),this.boundingBox=this.pointcloud.boundingBox.clone().applyMatrix4(this.matrix),this.root=new aa('r',this.boundingBox,
this.tileSize),this.version++);var a=null;c=$jscomp.makeIterator(c);for(var d=c.next();!d.done;d=c.next())if(d=d.value,void 0===d.demVersion||d.demVersion<this.version){a=d;break}if(null!==a){var l=a.getBoundingBox().clone().applyMatrix4(this.matrix),f=l.getSize(new THREE.Vector3),b=this.expandAndFindByBox(l,a.getLevel());a.demVersion=this.version;c=a.geometryNode.geometry.attributes.position.array;a={boundingBox:{min:a.getBoundingBox().min.toArray(),max:a.getBoundingBox().max.toArray()},position:(new Float32Array(c)).buffer};
var k=this;p.workerPool.runTask(A.DEM,function(a){a=new Float32Array(a.data.dem.data);for(var c=$jscomp.makeIterator(b),d=c.next();!d.done;d=c.next()){d=d.value;for(var x=d.box.getSize(new THREE.Vector3),u=0;u<k.tileSize;u++)for(var e=0;e<k.tileSize;e++){var g=k.tileSize*(d.box.min.x+u/(k.tileSize-1)*x.x-l.min.x)/f.x,h=k.tileSize*(d.box.min.y+e/(k.tileSize-1)*x.y-l.min.y)/f.y;0>g||g>k.tileSize||0>h||h>k.tileSize||(g=Math.min(Math.floor(g),k.tileSize-1),h=Math.min(Math.floor(h),k.tileSize-1),d.data[u+
k.tileSize*e]=a[g+k.tileSize*h])}d.createMipMap();d.mipMapNeedsUpdate=!0}},a,[a.position])}};J=function(){this.needsTransformUpdate=!0};J.prototype.getChildren=function(){};J.prototype.getBoundingBox=function(){};J.prototype.isLoaded=function(){};J.prototype.isGeometryNode=function(){};J.prototype.isTreeNode=function(){};J.prototype.getLevel=function(){};J.prototype.getBoundingSphere=function(){};var Y=function(){var c=THREE.Object3D.call(this)||this;c.dem=new ja(c);return c};$jscomp.inherits(Y,THREE.Object3D);
Y.prototype.initialized=function(){return null!==this.root};var Ca=function(){this.spacing=0;this.nodes=this.root=this.boundingBox=null;this.pointAttributes={};this.hierarchyStepSize=-1;this.serverURL=this.boundingSphere=this.projection=this.offset=this.baseDepth=this.schema=this.loader=null;this.normalize={color:!1,intensity:!1}};h.IDCount=0;h.prototype=Object.create(J.prototype);h.prototype.isGeometryNode=function(){return!0};h.prototype.isTreeNode=function(){return!1};h.prototype.isLoaded=function(){return this.loaded};
h.prototype.getBoundingSphere=function(){return this.boundingSphere};h.prototype.getBoundingBox=function(){return this.boundingBox};h.prototype.getLevel=function(){return this.level};h.prototype.getChildren=function(){for(var c=[],a=0;8>a;++a)this.children[a]&&c.push(this.children[a]);return c};h.prototype.getURL=function(){var c=this.greyhoundBounds;c=''+this.pcoGeometry.serverURL+'read?depthBegin='+(this.baseLoaded?this.level+this.pcoGeometry.baseDepth:0)+'&depthEnd='+(this.level+this.pcoGeometry.baseDepth+
1)+'&bounds=['+(c.min.x+','+c.min.y+','+c.min.z+','+c.max.x+','+c.max.y+','+c.max.z)+']&schema='+JSON.stringify(this.pcoGeometry.schema)+'&compress=true';this.scale&&(c+='&scale='+this.scale);if(this.greyhoundOffset){var a=this.greyhoundOffset;c+='&offset=['+a.x+','+a.y+','+a.z+']'}this.baseLoaded||(this.baseLoaded=!0);return c};h.prototype.addChild=function(c){this.children[c.index]=c;c.parent=this};h.prototype.load=function(){!0===this.loading||!0===this.loaded||p.numNodesLoading>=p.maxNodesLoading||
(this.loading=!0,p.numNodesLoading++,0===this.level%this.pcoGeometry.hierarchyStepSize&&this.hasChildren?this.loadHierarchyThenPoints():this.loadPoints())};h.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)};h.prototype.loadHierarchyThenPoints=function(){var c=[0,2,1,3,4,6,5,7],a=function(a){var d=0;Object.keys(a).forEach(function(a){'swd'===a?d+=1<<c[0]:'nwd'===a?d+=1<<c[1]:'swu'===a?d+=1<<c[2]:'nwu'===a?d+=1<<c[3]:'sed'===a?d+=1<<c[4]:'ned'===a?d+=1<<c[5]:'seu'===a?d+=1<<c[6]:
'neu'===a&&(d+=1<<c[7])});return d},d=function(l,f,b){var k,x;Object.keys(l).forEach(function(u){if('n'!==u){switch(u){case 'swd':k=l.swd;x=f+c[0];break;case 'nwd':k=l.nwd;x=f+c[1];break;case 'swu':k=l.swu;x=f+c[2];break;case 'nwu':k=l.nwu;x=f+c[3];break;case 'sed':k=l.sed;x=f+c[4];break;case 'ned':k=l.ned;x=f+c[5];break;case 'seu':k=l.seu;x=f+c[6];break;case 'neu':k=l.neu,x=f+c[7]}b.push({children:a(k),numPoints:k.n,name:x});d(k,x,b)}})};if(0===this.level%this.pcoGeometry.hierarchyStepSize){var l=
this.level+this.pcoGeometry.baseDepth,f=this.greyhoundBounds,b=''+this.pcoGeometry.serverURL+'hierarchy?bounds=['+(f.min.x+','+f.min.y+','+f.min.z+','+f.max.x+','+f.max.y+','+f.max.z)+']&depthBegin='+l+'&depthEnd='+(l+this.pcoGeometry.hierarchyStepSize+2);this.scale&&(b+='&scale='+this.scale);this.greyhoundOffset&&(l=this.greyhoundOffset,b+='&offset=['+l.x+','+l.y+','+l.z+']');var k=this,u=new XMLHttpRequest;u.overrideMimeType('text/plain');u.open('GET',b,!0);u.onload=function(a){try{var c=JSON.parse(u.responseText)||
{};a=[];k.numPoints=c.n;d(c,k.name,a);c={};c[k.name]=k;for(var l=k.pcoGeometry,f=0;f<a.length;f++){var b=a[f].name,x=a[f].numPoints,e=parseInt(b.charAt(b.length-1)),r=b.substring(0,b.length-1),g=c[r],m=b.length-1,w=v.createChildAABB(g.boundingBox,e),y=new h(b,l,w,k.scale,k.offset);y.level=m;y.numPoints=x;y.hasChildren=0<a[f].children;y.spacing=l.spacing/Math.pow(2,m);g.addChild(y);c[b]=y}k.loadPoints()}catch(La){p.numNodesLoading--,console.error('Potree: Exception thrown parsing points.',La)}};u.onerror=
function(a){console.log('Potree: Failed to load file! HTTP status '+u.status+', file:'+b,a)};u.send(null)}};h.prototype.getNumPoints=function(){return this.numPoints};h.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var c=0;c<this.oneTimeDisposeHandlers.length;c++)(0,this.oneTimeDisposeHandlers[c])();this.oneTimeDisposeHandlers=[]}};Object.assign(h.prototype,THREE.EventDispatcher.prototype);m.prototype.newerThan=function(c){c=
new m(c);return this.versionMajor>c.versionMajor||this.versionMajor===c.versionMajor&&this.versionMinor>c.versionMinor?!0:!1};m.prototype.equalOrHigher=function(c){c=new m(c);return this.versionMajor>c.versionMajor||this.versionMajor===c.versionMajor&&this.versionMinor>=c.versionMinor?!0:!1};m.prototype.upTo=function(c){return!this.newerThan(c)};var ra=function(c,a,d){this.version='string'===typeof c?new m(c):c;this.boundingBox=a;this.scale=d};ra.prototype.load=function(c){if(!c.loaded){var a=this,
d=c.getURL(),l=new XMLHttpRequest;l.overrideMimeType('text/plain');l.open('GET',d,!0);l.responseType='arraybuffer';l.overrideMimeType('text/plain; charset=x-user-defined');l.onload=function(){try{a.parse(c,l.response)}catch(f){console.error('Potree: Exception thrown parsing points.',f),p.numNodesLoading--}};l.onerror=function(a){p.numNodesLoading--;console.error('Potree: Failed to load file.',l,d)};l.send(null)}};ra.prototype.parse=function(c,a){var d=(new DataView(a,a.byteLength-4,4)).getUint32(0,
!0),l=c.pcoGeometry.pointAttributes;c.numPoints=d;d=c.boundingBox;var f=new THREE.Vector3;f=c.pcoGeometry.boundingBox.getCenter(f).sub(c.boundingBox.min);a={buffer:a,pointAttributes:l,version:this.version.version,schema:c.pcoGeometry.schema,min:[d.min.x,d.min.y,d.min.z],max:[d.max.x,d.max.y,d.max.z],offset:f.toArray(),scale:this.scale,normalize:c.pcoGeometry.normalize};p.workerPool.runTask(A.GREYHOUND,function(a){a=a.data;var d=a.attributeBuffers,l=new THREE.Box3((new THREE.Vector3).fromArray(a.tightBoundingBox.min),
(new THREE.Vector3).fromArray(a.tightBoundingBox.max)),f=new THREE.BufferGeometry,b;for(b in d){var x=d[b].buffer;parseInt(b)===y.POSITION_CARTESIAN?f.setAttribute('position',new THREE.BufferAttribute(new Float32Array(x),3)):parseInt(b)===y.COLOR_PACKED?f.setAttribute('color',new THREE.BufferAttribute(new Uint8Array(x),4,!0)):parseInt(b)===y.INTENSITY?f.setAttribute('intensity',new THREE.BufferAttribute(new Float32Array(x),1)):parseInt(b)===y.CLASSIFICATION?f.setAttribute('classification',new THREE.BufferAttribute(new Uint8Array(x),
1)):parseInt(b)===y.NORMAL_SPHEREMAPPED?f.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(x),3)):parseInt(b)===y.NORMAL_OCT16?f.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(x),3)):parseInt(b)===y.NORMAL?f.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(x),3)):parseInt(b)===y.INDICES?(x=new THREE.BufferAttribute(new Uint8Array(x),4),x.normalized=!0,f.setAttribute('indices',x)):parseInt(b)===y.SPACING&&(x=new THREE.BufferAttribute(new Float32Array(x),
1),f.setAttribute('spacing',x))}l.max.sub(l.min);l.min.set(0,0,0);c.numPoints=a.numPoints;c.geometry=f;c.mean=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a.mean))));c.tightBoundingBox=l;c.loaded=!0;c.loading=!1;p.numNodesLoading--},a,[a.buffer])};var P=function(){};P.getQueryParam=function(c){c=c.replace(/[[\]]/g,'\\$&');return(c=(new RegExp('[?&]'+c+'(=([^&#]*)|&|#|$)')).exec(window.location.href))?c[2]?decodeURIComponent(c[2].replace(/\+/g,' ')):'':null};
P.createSchema=function(c){var a=[{name:'X',size:4,type:'signed'},{name:'Y',size:4,type:'signed'},{name:'Z',size:4,type:'signed'}];c.forEach(function(c){'COLOR_PACKED'===c?(a.push({name:'Red',size:2,type:'unsigned'}),a.push({name:'Green',size:2,type:'unsigned'}),a.push({name:'Blue',size:2,type:'unsigned'})):'INTENSITY'===c?a.push({name:'Intensity',size:2,type:'unsigned'}):'CLASSIFICATION'===c&&a.push({name:'Classification',size:1,type:'unsigned'})});return a};P.fetch=function(c,a){var d=new XMLHttpRequest;
d.overrideMimeType('text/plain');d.open('GET',c,!0);d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status?a(null,d.responseText):a(d.responseText))};d.send(null)};P.fetchBinary=function(c,a){var d=new XMLHttpRequest;d.overrideMimeType('text/plain');d.open('GET',c,!0);d.responseType='arraybuffer';d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status?a(null,d.response):a(d.responseText))};d.send(null)};P.pointSizeFrom=function(c){return c.reduce(function(a,
c){return a+c.size},0)};P.getNormalization=function(c,a,d){var l=[{name:'X',size:4,type:'floating'},{name:'Y',size:4,type:'floating'},{name:'Z',size:4,type:'floating'},{name:'Red',size:2,type:'unsigned'},{name:'Green',size:2,type:'unsigned'},{name:'Blue',size:2,type:'unsigned'},{name:'Intensity',size:2,type:'unsigned'}];c=c+'read?depth='+a+'&schema='+JSON.stringify(l);P.fetchBinary(c,function(a,c){if(a)throw Error(a);a=new DataView(c);c=c.byteLength-4;for(var f=P.pointSizeFrom(l),b=!1,x=!1,e=0;e<
c;e+=f){if(255<a.getUint16(e+12,!0)||255<a.getUint16(e+14,!0)||255<a.getUint16(e+16,!0))b=!0;255<a.getUint16(e+18,!0)&&(x=!0);if(b&&x)break}d(null,{color:b,intensity:x})})};v.loadInfoJSON=function(c,a){};v.load=function(c,a){try{var d=c.split('greyhound://')[1];1===d.split('http://').length&&1===d.split('https://').length&&(d='http://'+d);P.fetch(d+'info',function(c,b){if(c)throw Error(c);c=JSON.parse(b);var l=new m('1.4'),f=c.bounds;b=c.scale||.01;Array.isArray(b)&&(b=Math.min(b[0],b[1],b[2]));P.getQueryParam('scale')&&
(b=parseFloat(P.getQueryParam('scale')));var u=Math.max(8,c.baseDepth),e=['POSITION_CARTESIAN'],q=!1,n=!1,Ba=!1;c.schema.forEach(function(a){'Intensity'===a.name&&e.push('INTENSITY');'Classification'===a.name&&e.push('CLASSIFICATION');'Red'===a.name?q=!0:'Green'===a.name?n=!0:'Blue'===a.name&&(Ba=!0)});q&&n&&Ba&&e.push('COLOR_PACKED');var t=new Ca;t.serverURL=d;t.spacing=(f[3]-f[0])/Math.pow(2,u);t.baseDepth=u;t.hierarchyStepSize=5;t.schema=P.createSchema(e);u=P.pointSizeFrom(t.schema);t.pointAttributes=
new g(e);t.pointAttributes.byteSize=u;f=new THREE.Box3((new THREE.Vector3).fromArray(f,0),(new THREE.Vector3).fromArray(f,3));u=f.min.clone();f.max.sub(f.min);f.min.set(0,0,0);t.projection=c.srs;t.boundingBox=f;t.boundingSphere=f.getBoundingSphere(new THREE.Sphere);t.scale=b;t.offset=u;t.loader=new ra(l,f,t.scale);l={};b=new h('r',t,f,b,u);b.level=0;b.hasChildren=!0;b.numPoints=c.numPoints;b.spacing=t.spacing;t.root=b;t.root.load();l.r=b;t.nodes=l;P.getNormalization(d,c.baseDepth,function(c,d){d.color&&
(t.normalize.color=!0);d.intensity&&(t.normalize.intensity=!0);a(t)})})}catch(l){console.log('Potree: Loading failed.',c,l),a()}};v.loadPointAttributes=function(c){c=c.pointAttributes;for(var a=new g,d=0;d<c.length;d++)a.add(e[c[d]]);return a};v.createChildAABB=function(c,a){var d=c.min;c=c.max;var b=(new THREE.Vector3).copy(c).sub(d).multiplyScalar(.5),f=new THREE.Vector3(b.x,0,0),x=new THREE.Vector3(0,b.y,0),k=new THREE.Vector3(0,0,b.z),u=d,e=(new THREE.Vector3).add(d).add(b);1===a?(d=(new THREE.Vector3).copy(u).add(k),
c=(new THREE.Vector3).copy(e).add(k)):3===a?(d=(new THREE.Vector3).copy(u).add(k).add(x),c=(new THREE.Vector3).copy(e).add(k).add(x)):0===a?(d=u,c=e):2===a?(d=(new THREE.Vector3).copy(u).add(x),c=(new THREE.Vector3).copy(e).add(x)):5===a?(d=(new THREE.Vector3).copy(u).add(k).add(f),c=(new THREE.Vector3).copy(e).add(k).add(f)):7===a?(d=(new THREE.Vector3).copy(u).add(b),c=(new THREE.Vector3).copy(e).add(b)):4===a?(d=(new THREE.Vector3).copy(u).add(f),c=(new THREE.Vector3).copy(e).add(f)):6===a&&(d=
(new THREE.Vector3).copy(u).add(f).add(x),c=(new THREE.Vector3).copy(e).add(f).add(x));return new THREE.Box3(d,c)};var sa=function(c,a,d){this.version='string'===typeof c?new m(c):c;this.boundingBox=a;this.scale=d};sa.prototype.load=function(c){if(!c.loaded){var a=c.getURL();this.version.equalOrHigher('1.4')&&(a+='.bin');var d=this,b=new XMLHttpRequest;b.open('GET',a,!0);b.responseType='arraybuffer';b.overrideMimeType('text/plain; charset=x-user-defined');b.onload=function(){try{d.parse(c,b.response)}catch(f){p.numNodesLoading--,
console.error('Potree: Exception thrown parsing points.',f)}};b.onerror=function(c){p.numNodesLoading--;console.error('Potree: Failed to load file.',b,a)};b.send(null);console.log('Loading '+a)}};sa.prototype.parse=function(c,a){var d=c.pcoGeometry.pointAttributes,b=a.byteLength/c.pcoGeometry.pointAttributes.byteSize;this.version.upTo('1.5')&&(c.numPoints=b);a={buffer:a,pointAttributes:d,version:this.version.version,min:[c.boundingBox.min.x,c.boundingBox.min.y,c.boundingBox.min.z],offset:[c.pcoGeometry.offset.x,
c.pcoGeometry.offset.y,c.pcoGeometry.offset.z],scale:this.scale,spacing:c.spacing,hasChildren:c.hasChildren,name:c.name};p.workerPool.runTask(A.BINARY_DECODER,function(a){var b=a.data;if(void 0!==b.error)p.numNodesLoading--,console.error('Potree: Binary worker error.',b);else{var l=b.attributeBuffers,f=new THREE.Box3((new THREE.Vector3).fromArray(b.tightBoundingBox.min),(new THREE.Vector3).fromArray(b.tightBoundingBox.max)),e=new THREE.BufferGeometry,q;for(q in l){var n=l[q].buffer;parseInt(q)===
y.POSITION_CARTESIAN?e.setAttribute('position',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(q)===y.COLOR_PACKED?e.setAttribute('color',new THREE.BufferAttribute(new Uint8Array(n),4,!0)):parseInt(q)===y.INTENSITY?e.setAttribute('intensity',new THREE.BufferAttribute(new Float32Array(n),1)):parseInt(q)===y.CLASSIFICATION?e.setAttribute('classification',new THREE.BufferAttribute(new Uint8Array(n),1)):parseInt(q)===y.NORMAL_SPHEREMAPPED?e.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),
3)):parseInt(q)===y.NORMAL_OCT16?e.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(q)===y.NORMAL?e.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(q)===y.INDICES?(n=new THREE.BufferAttribute(new Uint8Array(n),4),n.normalized=!0,e.setAttribute('indices',n)):parseInt(q)===y.SPACING&&(n=new THREE.BufferAttribute(new Float32Array(n),1),e.setAttribute('spacing',n))}f.max.sub(f.min);f.min.set(0,0,0);c.numPoints=a.data.buffer.byteLength/d.byteSize;
c.geometry=e;c.mean=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(b.mean))));c.tightBoundingBox=f;c.loaded=!0;c.loading=!1;c.estimatedSpacing=b.estimatedSpacing;p.numNodesLoading--}},a,[a.buffer])};var Aa=[function(c){return{position:[c.getInt32(0,!0),c.getInt32(4,!0),c.getInt32(8,!0)],intensity:c.getUint16(12,!0),classification:c.getUint8(16,!0)}},function(c){return{position:[c.getInt32(0,!0),c.getInt32(4,!0),c.getInt32(8,!0)],intensity:c.getUint16(12,!0),
classification:c.getUint8(16,!0)}},function(c){return{position:[c.getInt32(0,!0),c.getInt32(4,!0),c.getInt32(8,!0)],intensity:c.getUint16(12,!0),classification:c.getUint8(16,!0),color:[c.getUint16(20,!0),c.getUint16(22,!0),c.getUint16(24,!0)]}},function(c){return{position:[c.getInt32(0,!0),c.getInt32(4,!0),c.getInt32(8,!0)],intensity:c.getUint16(12,!0),classification:c.getUint8(16,!0),color:[c.getUint16(28,!0),c.getUint16(30,!0),c.getUint16(32,!0)]}}];N.prototype.open=function(){this.readOffset=0;
return new Promise(function(c,a){setTimeout(c,0)})};N.prototype.getHeader=function(){var c=this;return new Promise(function(a,d){setTimeout(function(){var d=c.arraybuffer,b={};b.pointsOffset=D(d,Uint32Array,96);b.pointsFormatId=D(d,Uint8Array,104);b.pointsStructSize=D(d,Uint16Array,105);b.pointsCount=D(d,Uint32Array,107);var x=131;b.scale=D(d,Float64Array,x,3);x+=24;b.offset=D(d,Float64Array,x,3);d=D(d,Float64Array,x+24,6);b.maxs=[d[0],d[2],d[4]];b.mins=[d[1],d[3],d[5]];c.header=b;a(c.header)},0)})};
N.prototype.readData=function(c,a,d){var b=this;return new Promise(function(a,l){setTimeout(function(){if(!b.header)return l(Error('Cannot start reading data till a header request is issued'));if(1>=d){c=Math.min(c,b.header.pointsCount-b.readOffset);var f=b.header.pointsOffset+b.readOffset*b.header.pointsStructSize;a({buffer:b.arraybuffer.slice(f,f+c*b.header.pointsStructSize),count:c,hasMoreData:b.readOffset+c<b.header.pointsCount});b.readOffset+=c}else{for(var x=Math.min(c*d,b.header.pointsCount-
b.readOffset),e=0,q=new Uint8Array(Math.ceil(x/d)*b.header.pointsStructSize),n=0;n<x;n++)0===n%d&&(f=b.header.pointsOffset+b.readOffset*b.header.pointsStructSize,f=new Uint8Array(b.arraybuffer,f,b.header.pointsStructSize),q.set(f,e*b.header.pointsStructSize),e++),b.readOffset++;a({buffer:q.buffer,count:e,hasMoreData:b.readOffset<b.header.pointsCount})}},0)})};N.prototype.close=function(){var c=this;return new Promise(function(a,d){c.arraybuffer=null;setTimeout(a,0)})};w.prototype.open=function(){var c=
this;return new Promise(function(a,d){c.dorr({type:'open',arraybuffer:c.arraybuffer},function(c){if(1!==c.status)return d(Error('Failed to open file'));a(!0)})})};w.prototype.getHeader=function(){var c=this;return new Promise(function(a,d){c.dorr({type:'header'},function(c){if(1!==c.status)return d(Error('Failed to get header'));a(c.header)})})};w.prototype.readData=function(c,a,d){var b=this;return new Promise(function(f,l){b.dorr({type:'read',count:c,offset:a,skip:d},function(a){if(1!==a.status)return l(Error('Failed to read data'));
f({buffer:a.buffer,count:a.count,hasMoreData:a.hasMoreData})})})};w.prototype.close=function(){var c=this;return new Promise(function(a,d){c.dorr({type:'close'},function(c){if(1!==c.status)return d(Error('Failed to close file'));a(!0)})})};K.prototype.determineFormat=function(){var c=D(this.arraybuffer,Uint8Array,104),a=(c&128)>>7,d=(c&64)>>6;if(1===a&&1===d)throw Error('Old style compression not supported');this.formatId=c&63;this.isCompressed=1===a||1===d};K.prototype.determineVersion=function(){var c=
new Int8Array(this.arraybuffer,24,2);this.version=10*c[0]+c[1];this.versionAsString=c[0]+'.'+c[1]};K.prototype.open=function(){return this.loader.open()};K.prototype.getHeader=function(){return this.loader.getHeader()};K.prototype.readData=function(c,a,d){return this.loader.readData(c,a,d)};K.prototype.close=function(){return this.loader.close()};ba.prototype.getPoint=function(c){if(0>c||c>=this.pointsCount)throw Error('Point index out of range');return this.decoder(new DataView(this.arrayb,c*this.pointSize,
this.pointSize))};var la=function(c){this.version='string'===typeof c?new m(c):c};la.prototype.load=function(c){if(!c.loaded){var a=c.pcoGeometry.pointAttributes,d=c.getURL();this.version.equalOrHigher('1.4')&&(d+='.'+a.toLowerCase());var b=this,f=new XMLHttpRequest;f.open('GET',d,!0);f.responseType='arraybuffer';f.overrideMimeType('text/plain; charset=x-user-defined');f.onload=function(){if(f.response instanceof ArrayBuffer)try{b.parse(c,f.response)}catch(x){console.error('Potree: Exception thrown parsing points.',
x),p.numNodesLoading--}else p.numNodesLoading--,console.log('Potree: LASLAZLoader xhr response is not a ArrayBuffer.')};f.onerror=function(){p.numNodesLoading--;console.log('Potree: LASLAZLoader failed to load file, '+f.status+', file: '+d)};f.send(null)}};la.prototype.parse=function(c,a){var d=new K(a),b=new Da(c);d.open().then(function(a){d.isOpen=!0;return d}).catch(function(a){console.log('Potree: Failed to open file.')}).then(function(a){return a.getHeader().then(function(c){return[a,c]})}).then(function(a){var c=
a[0],d=a[1],f=0,l=function(){return c.readData(1E6,0,1).then(function(a){b.push(new ba(a.buffer,d.pointsFormatId,d.pointsStructSize,a.count,d.scale,d.offset,d.mins,d.maxs));f+=a.count;if(a.hasMoreData)return l();d.totalRead=f;d.versionAsString=c.versionAsString;d.isCompressed=c.isCompressed;return[c,d,b]})};return l()}).then(function(a){var c=a[0];return c.close().then(function(){c.isOpen=!1;return a.slice(1)}).catch(function(a){if(c.isOpen)return c.close().then(function(){c.isOpen=!1;throw a;});
throw a;})})};la.prototype.handle=function(c,a){};var Da=function(c){this.node=c};Da.prototype.push=function(c){var a=this,d={buffer:c.arrayb,numPoints:c.pointsCount,pointSize:c.pointSize,pointFormatID:2,scale:c.scale,offset:c.offset,mins:c.mins,maxs:c.maxs},b=p.workerPool.getWorker(A.LAS_DECODER);b.onmessage=function(d){var f=new THREE.BufferGeometry,l=c.pointsCount,e=new Float32Array(d.data.position),r=new Uint8Array(d.data.color),q=new Float32Array(d.data.intensity),n=new Uint8Array(d.data.classification),
g=new Uint8Array(d.data.returnNumber),h=new Uint8Array(d.data.numberOfReturns),m=new Uint16Array(d.data.pointSourceID),ia=new Uint8Array(d.data.indices);f.setAttribute('position',new THREE.BufferAttribute(e,3));f.setAttribute('color',new THREE.BufferAttribute(r,4,!0));f.setAttribute('intensity',new THREE.BufferAttribute(q,1));f.setAttribute('classification',new THREE.BufferAttribute(n,1));f.setAttribute('returnNumber',new THREE.BufferAttribute(g,1));f.setAttribute('numberOfReturns',new THREE.BufferAttribute(h,
1));f.setAttribute('pointSourceID',new THREE.BufferAttribute(m,1));f.setAttribute('indices',new THREE.BufferAttribute(ia,4));f.attributes.indices.normalized=!0;e=new THREE.Box3((new THREE.Vector3).fromArray(d.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(d.data.tightBoundingBox.max));f.boundingBox=a.node.boundingBox;a.node.tightBoundingBox=e;a.node.geometry=f;a.node.numPoints=l;a.node.loaded=!0;a.node.loading=!1;p.numNodesLoading--;a.node.mean=new (Function.prototype.bind.apply(THREE.Vector3,
[null].concat($jscomp.arrayFromIterable(d.data.mean))));p.workerPool.returnWorker(A.LAS_DECODER,b)};b.postMessage(d,[d.buffer])};var Ea=function(){this.octreeDir=this.url=null;this.spacing=0;this.pointAttributes=this.nodes=this.root=this.boundingBox=null;this.hierarchyStepSize=-1;this.loader=null},E=function(c,a,d){this.needsTransformUpdate=!0;this.id=E.IDCount++;this.name=c;this.index=parseInt(c.charAt(c.length-1));this.pcoGeometry=a;this.geometry=null;this.boundingBox=d;this.boundingSphere=d.getBoundingSphere(new THREE.Sphere);
this.children={};this.numPoints=0;this.level=null;this.loaded=!1;this.oneTimeDisposeHandlers=[];return this};$jscomp.inherits(E,J);E.prototype.isGeometryNode=function(){return!0};E.prototype.getLevel=function(){return this.level};E.prototype.isTreeNode=function(){return!1};E.prototype.isLoaded=function(){return this.loaded};E.prototype.getBoundingSphere=function(){return this.boundingSphere};E.prototype.getBoundingBox=function(){return this.boundingBox};E.prototype.getChildren=function(){for(var c=
[],a=0;8>a;a++)this.children[a]&&c.push(this.children[a]);return c};E.prototype.getURL=function(){var c='',a=this.pcoGeometry.loader.version;a.equalOrHigher('1.5')?c=this.pcoGeometry.octreeDir+'/'+this.getHierarchyPath()+'/'+this.name:a.equalOrHigher('1.4')?c=this.pcoGeometry.octreeDir+'/'+this.name:a.upTo('1.3')&&(c=this.pcoGeometry.octreeDir+'/'+this.name);return c};E.prototype.getHierarchyPath=function(){for(var c='r/',a=this.pcoGeometry.hierarchyStepSize,d=this.name.substr(1),b=Math.floor(d.length/
a),f=0;f<b;f++)c+=d.substr(f*a,a)+'/';return c=c.slice(0,-1)};E.prototype.addChild=function(c){this.children[c.index]=c;c.parent=this};E.prototype.load=function(){if(!(!0===this.loading||!0===this.loaded||p.numNodesLoading>=p.maxNodesLoading)){this.loading=!0;p.numNodesLoading++;try{this.pcoGeometry.loader.version.equalOrHigher('1.5')?0===this.level%this.pcoGeometry.hierarchyStepSize&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints():this.loadPoints()}catch(c){p.numNodesLoading--,console.error('Potree: Exception thrown loading points file.',
c)}}};E.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)};E.prototype.loadHierachyThenPoints=function(){var c=this;if(0===c.level%c.pcoGeometry.hierarchyStepSize){var a=c.pcoGeometry.octreeDir+'/'+c.getHierarchyPath()+'/'+c.name+'.hrc',d=new XMLHttpRequest;d.open('GET',a,!0);d.responseType='arraybuffer';d.overrideMimeType('text/plain; charset=x-user-defined');d.onload=function(a){try{var b=d.response,l=new DataView(b);a=[];var k=l.getUint8(0),e=l.getUint32(1,!0);c.numPoints=e;a.push({children:k,
numPoints:e,name:c.name});k=[];for(e=5;0<a.length;){for(var r=a.shift(),q=1,n=0;8>n;n++){if(0!==(r.children&q)){var g=r.name+n,h=l.getUint8(e),m=l.getUint32(e+1,!0);a.push({children:h,numPoints:m,name:g});k.push({children:h,numPoints:m,name:g});e+=5}q*=2}if(e===b.byteLength)break}b={};b[c.name]=c;var ia=c.pcoGeometry;for(n=0;n<k.length;n++){var ca=k[n].name,z=k[n].numPoints,v=parseInt(ca.charAt(ca.length-1)),y=ca.substring(0,ca.length-1),w=b[y],B=ca.length-1,A=da.createChildAABB(w.boundingBox,v),
O=new E(ca,ia,A);O.level=B;O.numPoints=z;O.hasChildren=0<k[n].children;O.spacing=ia.spacing/Math.pow(2,B);w.addChild(O);b[ca]=O}c.loadPoints()}catch(Ka){p.numNodesLoading--,console.error('Potree: Exception thrown parsing points.',Ka)}};d.onerror=function(c){p.numNodesLoading--;console.error('Potree: Failed to load file.',d.status,a,c)};d.send(null)}};E.prototype.getNumPoints=function(){return this.numPoints};E.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();
this.geometry=null;this.loaded=!1;for(var c=0;c<this.oneTimeDisposeHandlers.length;c++)(0,this.oneTimeDisposeHandlers[c])();this.oneTimeDisposeHandlers=[]}};E.IDCount=0;Object.assign(E.prototype,THREE.EventDispatcher.prototype);var da=function(){};da.load=function(c,a){var d=new Ea;d.url=c;var b=new XMLHttpRequest;b.overrideMimeType('text/plain');b.open('GET',c,!0);b.onload=function(){var f=JSON.parse(b.responseText),l=new m(f.version);0===f.octreeDir.indexOf('http')?d.octreeDir=f.octreeDir:d.octreeDir=
c+'/../'+f.octreeDir;d.spacing=f.spacing;d.hierarchyStepSize=f.hierarchyStepSize;d.pointAttributes=f.pointAttributes;var k=new THREE.Vector3(f.boundingBox.lx,f.boundingBox.ly,f.boundingBox.lz),e=new THREE.Vector3(f.boundingBox.ux,f.boundingBox.uy,f.boundingBox.uz),r=new THREE.Box3(k,e);e=r.clone();f.tightBoundingBox&&(e.min.copy(new THREE.Vector3(f.tightBoundingBox.lx,f.tightBoundingBox.ly,f.tightBoundingBox.lz)),e.max.copy(new THREE.Vector3(f.tightBoundingBox.ux,f.tightBoundingBox.uy,f.tightBoundingBox.uz)));
k=k.clone();r.min.sub(k);r.max.sub(k);e.min.sub(k);e.max.sub(k);d.projection=f.projection;d.boundingBox=r;d.tightBoundingBox=e;d.boundingSphere=r.getBoundingSphere(new THREE.Sphere);d.tightBoundingSphere=e.getBoundingSphere(new THREE.Sphere);d.offset=k;'LAS'===f.pointAttributes||'LAZ'===f.pointAttributes?d.loader=new la(f.version):(d.loader=new sa(f.version,r,f.scale),d.pointAttributes=new g(d.pointAttributes));k={};e='r';r=new E(e,d,r);r.level=0;r.hasChildren=!0;r.spacing=d.spacing;r.numPoints=l.upTo('1.5')?
f.hierarchy[0][1]:0;d.root=r;d.root.load();k[e]=r;if(l.upTo('1.4'))for(l=1;l<f.hierarchy.length;l++){e=f.hierarchy[l][0];var q=f.hierarchy[l][1];r=parseInt(e.charAt(e.length-1));var n=e.substring(0,e.length-1);n=k[n];var h=e.length-1;r=da.createChildAABB(n.boundingBox,r);r=new E(e,d,r);r.level=h;r.numPoints=q;r.spacing=d.spacing/Math.pow(2,h);n.addChild(r);k[e]=r}d.nodes=k;a(d)};b.onerror=function(d){p.numNodesLoading--;console.log('Potree: loading file failed.',c,d);a()};b.send(null)};da.loadPointAttributes=
function(c){c=c.pointAttributes;for(var a=new g,d=0;d<c.length;d++)a.add(e[c[d]]);return a};da.createChildAABB=function(c,a){var d=c.min.clone();c=c.max.clone();var b=(new THREE.Vector3).subVectors(c,d);0<(a&1)?d.z+=b.z/2:c.z-=b.z/2;0<(a&2)?d.y+=b.y/2:c.y-=b.y/2;0<(a&4)?d.x+=b.x/2:c.x-=b.x/2;return new THREE.Box3(d,c)};var ta=function(){};ta.prototype.load=function(c){var a=this;if(!c.loaded){var d=c.url()+'.bin',b=new XMLHttpRequest;b.open('GET',d,!0);b.responseType='arraybuffer';b.overrideMimeType('text/plain; charset=x-user-defined');
b.onreadystatechange=function(){4===b.readyState&&(200===b.status?a.parse(c,b.response):console.log('Failed '+d+': '+b.status))};try{b.send(null)}catch(f){console.log('Failed request: '+f)}}};ta.prototype.parse=function(c,a){var d=p.workerPool.getWorker(A.EPT_BINARY_DECODER);d.onmessage=function(a){var b=new THREE.BufferGeometry,l=a.data.numPoints,k=new Float32Array(a.data.position);b.setAttribute('position',new THREE.BufferAttribute(k,3));k=new Uint8Array(a.data.indices);b.setAttribute('indices',
new THREE.BufferAttribute(k,4));a.data.color&&(k=new Uint8Array(a.data.color),b.setAttribute('color',new THREE.BufferAttribute(k,4,!0)));a.data.intensity&&(k=new Float32Array(a.data.intensity),b.setAttribute('intensity',new THREE.BufferAttribute(k,1)));a.data.classification&&(k=new Uint8Array(a.data.classification),b.setAttribute('classification',new THREE.BufferAttribute(k,1)));a.data.returnNumber&&(k=new Uint8Array(a.data.returnNumber),b.setAttribute('returnNumber',new THREE.BufferAttribute(k,1)));
a.data.numberOfReturns&&(k=new Uint8Array(a.data.numberOfReturns),b.setAttribute('numberOfReturns',new THREE.BufferAttribute(k,1)));a.data.pointSourceId&&(k=new Uint16Array(a.data.pointSourceId),b.setAttribute('pointSourceID',new THREE.BufferAttribute(k,1)));b.attributes.indices.normalized=!0;k=new THREE.Box3((new THREE.Vector3).fromArray(a.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(a.data.tightBoundingBox.max));c.doneLoading(b,k,l,new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a.data.mean)))));
p.workerPool.returnWorker(A.EPT_BINARY_DECODER,d)};a={buffer:a,schema:c.ept.schema,scale:c.ept.eptScale,offset:c.ept.eptOffset,mins:function(a){return[a.x,a.y,a.z]}(c.key.b.min)};d.postMessage(a,[a.buffer])};var ua=function(){};ua.prototype.load=function(c){var a=this;if(!c.loaded){var d=c.url()+'.laz',b=new XMLHttpRequest;b.open('GET',d,!0);b.responseType='arraybuffer';b.overrideMimeType('text/plain; charset=x-user-defined');b.onreadystatechange=function(){4===b.readyState&&(200===b.status?a.parse(c,
b.response):console.log('Failed '+d+': '+b.status))};b.send(null)}};ua.prototype.parse=function(c,a){var d=new K(a),b=new Fa(c);d.open().then(function(){d.isOpen=!0;return d.getHeader()}).then(function(a){var f=0,l=function(a){return[a.x,a.y,a.z]},e=l(c.key.b.min),r=l(c.key.b.max),q=function(){return d.readData(1E6,0,1).then(function(c){var l=new ba(c.buffer,a.pointsFormatId,a.pointsStructSize,c.count,a.scale,a.offset,e,r);l.extraBytes=a.extraBytes;l.pointsFormatId=a.pointsFormatId;b.push(l);f+=c.count;
if(c.hasMoreData)return q();a.totalRead=f;a.versionAsString=d.versionAsString;a.isCompressed=d.isCompressed;return null})};return q()}).then(function(){return d.close()}).then(function(){return d.isOpen=!1}).catch(function(a){console.log('Error reading LAZ:',a);if(d.isOpen)d.close().then(function(){d.isOpen=!1;throw a;});else throw a;})};var Fa=function(c){this.node=c};Fa.prototype.push=function(c){var a=this,d=p.workerPool.getWorker(A.EPT_LAS_ZIP_DECODER);d.onmessage=function(b){var f=new THREE.BufferGeometry,
l=c.pointsCount,e=new Float32Array(b.data.position),r=new Uint8Array(b.data.color),q=new Float32Array(b.data.intensity),n=new Uint8Array(b.data.classification),g=new Uint8Array(b.data.returnNumber),h=new Uint8Array(b.data.numberOfReturns),m=new Uint16Array(b.data.pointSourceID),ia=new Uint8Array(b.data.indices);f.setAttribute('position',new THREE.BufferAttribute(e,3));f.setAttribute('color',new THREE.BufferAttribute(r,4,!0));f.setAttribute('intensity',new THREE.BufferAttribute(q,1));f.setAttribute('classification',
new THREE.BufferAttribute(n,1));f.setAttribute('returnNumber',new THREE.BufferAttribute(g,1));f.setAttribute('numberOfReturns',new THREE.BufferAttribute(h,1));f.setAttribute('pointSourceID',new THREE.BufferAttribute(m,1));f.setAttribute('indices',new THREE.BufferAttribute(ia,4));f.attributes.indices.normalized=!0;e=new THREE.Box3((new THREE.Vector3).fromArray(b.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(b.data.tightBoundingBox.max));a.node.doneLoading(f,e,l,new (Function.prototype.bind.apply(THREE.Vector3,
[null].concat($jscomp.arrayFromIterable(b.data.mean)))));p.workerPool.returnWorker(A.EPT_LAS_ZIP_DECODER,d)};var b={buffer:c.arrayb,numPoints:c.pointsCount,pointSize:c.pointSize,pointFormatID:c.pointsFormatId,scale:c.scale,offset:c.offset,mins:c.mins,maxs:c.maxs};d.postMessage(b,[b.buffer])};var L=function(){};L.toVector3=function(c,a){return(new THREE.Vector3).fromArray(c,a||0)};L.toBox3=function(c){return new THREE.Box3(L.toVector3(c),L.toVector3(c,3))};L.findDim=function(c,a){c=c.find(function(c){return c.name==
a});if(!c)throw Error('Failed to find '+a+' in schema');return c};L.sphereFrom=function(c){return c.getBoundingSphere(new THREE.Sphere)};var Ga=function(c,a){var d=a.schema,b=a.bounds,f=a.boundsConforming,e=[L.findDim(d,'X'),L.findDim(d,'Y'),L.findDim(d,'Z')],k=e.map(function(a){return a.scale||1});e=e.map(function(a){return a.offset||0});this.eptScale=L.toVector3(k);this.eptOffset=L.toVector3(e);this.url=c;this.info=a;this.type='ept';this.schema=d;this.span=a.span||a.ticks;this.boundingBox=L.toBox3(b);
this.tightBoundingBox=L.toBox3(f);this.offset=L.toVector3([0,0,0]);this.boundingSphere=L.sphereFrom(this.boundingBox);this.tightBoundingSphere=L.sphereFrom(this.tightBoundingBox);this.version=new m('1.6');this.fallbackProjection=this.projection=null;a.srs&&a.srs.horizontal&&(this.projection=a.srs.authority+':'+a.srs.horizontal);a.srs.wkt&&(this.projection?this.fallbackProjection=a.srs.wkt:this.projection=a.srs.wkt);this.pointAttributes='LAZ';this.spacing=(this.boundingBox.max.x-this.boundingBox.min.x)/
this.span;this.loader='binary'==(a.dataType||'laszip')?new ta:new ua},ma=function(c,a,d,b,f,e){this.ept=c;this.b=a;this.d=d;this.x=b||0;this.y=f||0;this.z=e||0};ma.prototype.name=function(){return this.d+'-'+this.x+'-'+this.y+'-'+this.z};ma.prototype.step=function(c,a,d){var b=this.b.min.clone(),f=this.b.max.clone(),e=(new THREE.Vector3).subVectors(f,b);c?b.x+=e.x/2:f.x-=e.x/2;a?b.y+=e.y/2:f.y-=e.y/2;d?b.z+=e.z/2:f.z-=e.z/2;return new ma(this.ept,new THREE.Box3(b,f),this.d+1,2*this.x+c,2*this.y+a,
2*this.z+d)};ma.prototype.children=function(){for(var c=[],a=0;2>a;++a)for(var d=0;2>d;++d)for(var b=0;2>b;++b){var f=this.step(a,d,b).name();c.includes(f)||(c=c.concat(f))}return c};var C=function(c,a,d,b,f,e){this.needsTransformUpdate=!0;this.ept=c;this.key=new ma(this.ept,a||this.ept.boundingBox,d||0,b,f,e);this.id=C.IDCount++;this.geometry=null;this.tightBoundingBox=this.boundingBox=this.key.b;this.spacing=this.ept.spacing/Math.pow(2,this.key.d);this.boundingSphere=L.sphereFrom(this.boundingBox);
this.hasChildren=!1;this.children={};this.numPoints=-1;this.level=this.key.d;this.loading=this.loaded=!1;this.oneTimeDisposeHandlers=[];c=this.key;this.name=this.toPotreeName(c.d,c.x,c.y,c.z);this.index=parseInt(this.name.charAt(this.name.length-1));return this};$jscomp.inherits(C,J);C.prototype.isGeometryNode=function(){return!0};C.prototype.getLevel=function(){return this.level};C.prototype.isTreeNode=function(){return!1};C.prototype.isLoaded=function(){return this.loaded};C.prototype.getBoundingSphere=
function(){return this.boundingSphere};C.prototype.getBoundingBox=function(){return this.boundingBox};C.prototype.url=function(){return this.ept.url+'ept-data/'+this.filename()};C.prototype.getNumPoints=function(){return this.numPoints};C.prototype.filename=function(){return this.key.name()};C.prototype.getChildren=function(){for(var c=[],a=0;8>a;a++)this.children[a]&&c.push(this.children[a]);return c};C.prototype.addChild=function(c){this.children[c.index]=c;c.parent=this};C.prototype.load=function(){this.loaded||
this.loading||p.numNodesLoading>=p.maxNodesLoading||(this.loading=!0,p.numNodesLoading++,-1===this.numPoints&&this.loadHierarchy(),this.loadPoints())};C.prototype.loadPoints=function(){this.ept.loader.load(this)};C.prototype.loadHierarchy=function(){var c=this,a,d,b,f,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return a={},a[c.filename()]=c,c.hasChildren=!1,d=c.ept.url+'ept-hierarchy/'+c.filename()+'.json',l.yield(fetch(d),2);if(3!=l.nextAddress)return b=l.yieldResult,
l.yield(b.json(),3);f=l.yieldResult;e=Object.keys(f).sort(function(a,c){var d=$jscomp.makeIterator(a.split('-').map(function(a){return parseInt(a,10)}));a=d.next().value;var b=d.next().value,f=d.next().value;d=d.next().value;var l=$jscomp.makeIterator(c.split('-').map(function(a){return parseInt(a,10)}));c=l.next().value;var e=l.next().value,k=l.next().value;l=l.next().value;return a<c?-1:a>c?1:b<e?-1:b>e?1:f<k?-1:f>k?1:d<l?-1:d>l?1:0});e.forEach(function(d){var b=$jscomp.makeIterator(d.split('-').map(function(a){return parseInt(a,
10)})),l=b.next().value,e=b.next().value,k=b.next().value,x=b.next().value;if(b=a[l-1+'-'+(e>>1)+'-'+(k>>1)+'-'+(x>>1)])b.hasChildren=!0,e=b.key.step(e&1,k&1,x&1),k=new C(c.ept,e.b,e.d,e.x,e.y,e.z),k.level=l,k.numPoints=f[d],b.addChild(k),a[e.name()]=k});l.jumpToEnd()})};C.prototype.doneLoading=function(c,a,d,b){c.boundingBox=this.boundingBox;this.geometry=c;this.tightBoundingBox=a;this.numPoints=d;this.mean=b;this.loaded=!0;this.loading=!1;p.numNodesLoading--};C.prototype.toPotreeName=function(c,
a,d,b){for(var f='r',l=0;l<c;++l){var e=1<<c-l-1,u=0;a&e&&(u+=4);d&e&&(u+=2);b&e&&(u+=1);f+=u}return f};C.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var c=0;c<this.oneTimeDisposeHandlers.length;c++)(0,this.oneTimeDisposeHandlers[c])();this.oneTimeDisposeHandlers=[]}};C.IDCount=0;var xa=function(){};xa.load=function(c,a){var d,b,f,e,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return l.yield(fetch(c),
2);if(3!=l.nextAddress)return d=l.yieldResult,l.yield(d.json(),3);b=l.yieldResult;f=c.substr(0,c.lastIndexOf('ept.json'));e=new Ga(f,b);k=new C(e);e.root=k;e.root.load();a(e);l.jumpToEnd()})};var Z=function(){};Z.generateDataTexture=function(c,a,d){var b=c*a,f=new Uint8Array(4*c*a),e=Math.floor(255*d.r),k=Math.floor(255*d.g);d=Math.floor(255*d.b);for(var u=0;u<b;u++)f[3*u]=e,f[3*u+1]=k,f[3*u+2]=d;c=new THREE.DataTexture(f,c,a,THREE.RGBAFormat);c.needsUpdate=!0;c.magFilter=THREE.NearestFilter;return c};
Z.computeTransformedBoundingBox=function(c,a){c=[(new THREE.Vector3(c.min.x,c.min.y,c.min.z)).applyMatrix4(a),(new THREE.Vector3(c.min.x,c.min.y,c.min.z)).applyMatrix4(a),(new THREE.Vector3(c.max.x,c.min.y,c.min.z)).applyMatrix4(a),(new THREE.Vector3(c.min.x,c.max.y,c.min.z)).applyMatrix4(a),(new THREE.Vector3(c.min.x,c.min.y,c.max.z)).applyMatrix4(a),(new THREE.Vector3(c.min.x,c.max.y,c.max.z)).applyMatrix4(a),(new THREE.Vector3(c.max.x,c.max.y,c.min.z)).applyMatrix4(a),(new THREE.Vector3(c.max.x,
c.min.y,c.max.z)).applyMatrix4(a),(new THREE.Vector3(c.max.x,c.max.y,c.max.z)).applyMatrix4(a)];a=new THREE.Box3;a.setFromPoints(c);return a};var Ha={RAINBOW:[[0,new THREE.Color(.278,0,.714)],[1/6,new THREE.Color(0,0,1)],[2/6,new THREE.Color(0,1,1)],[.5,new THREE.Color(0,1,0)],[4/6,new THREE.Color(1,1,0)],[5/6,new THREE.Color(1,.64,0)],[1,new THREE.Color(1,0,0)]],SPECTRAL:[[0,new THREE.Color(.3686,.3098,.6353)],[.1,new THREE.Color(.1961,.5333,.7412)],[.2,new THREE.Color(.4,.7608,.6471)],[.3,new THREE.Color(.6706,
.8667,.6431)],[.4,new THREE.Color(.902,.9608,.5961)],[.5,new THREE.Color(1,1,.749)],[.6,new THREE.Color(.9961,.8784,.5451)],[.7,new THREE.Color(.9922,.6824,.3804)],[.8,new THREE.Color(.9569,.4275,.2627)],[.9,new THREE.Color(.8353,.2431,.3098)],[1,new THREE.Color(.6196,.0039,.2588)]],PLASMA:[[0,new THREE.Color(.241,.015,.61)],[.1,new THREE.Color(.387,.001,.654)],[.2,new THREE.Color(.524,.025,.653)],[.3,new THREE.Color(.651,.125,.596)],[.4,new THREE.Color(.752,.227,.513)],[.5,new THREE.Color(.837,.329,
.431)],[.6,new THREE.Color(.907,.435,.353)],[.7,new THREE.Color(.963,.554,.272)],[.8,new THREE.Color(.992,.681,.195)],[.9,new THREE.Color(.987,.822,.144)],[1,new THREE.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new THREE.Color(.1647,.2824,.3451)],[.1,new THREE.Color(.1338,.3555,.4227)],[.2,new THREE.Color(.061,.4319,.4864)],[.3,new THREE.Color(0,.5099,.5319)],[.4,new THREE.Color(0,.5881,.5569)],[.5,new THREE.Color(.137,.665,.5614)],[.6,new THREE.Color(.2906,.7395,.5477)],[.7,new THREE.Color(.4453,.8099,
.5201)],[.8,new THREE.Color(.6102,.8748,.485)],[.9,new THREE.Color(.7883,.9323,.4514)],[1,new THREE.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new THREE.Color(.267,.005,.329)],[.1,new THREE.Color(.283,.141,.458)],[.2,new THREE.Color(.254,.265,.53)],[.3,new THREE.Color(.207,.372,.553)],[.4,new THREE.Color(.164,.471,.558)],[.5,new THREE.Color(.128,.567,.551)],[.6,new THREE.Color(.135,.659,.518)],[.7,new THREE.Color(.267,.749,.441)],[.8,new THREE.Color(.478,.821,.318)],[.9,new THREE.Color(.741,.873,.15)],
[1,new THREE.Color(.993,.906,.144)]],INFERNO:[[0,new THREE.Color(.077,.042,.206)],[.1,new THREE.Color(.225,.036,.388)],[.2,new THREE.Color(.373,.074,.432)],[.3,new THREE.Color(.522,.128,.42)],[.4,new THREE.Color(.665,.182,.37)],[.5,new THREE.Color(.797,.255,.287)],[.6,new THREE.Color(.902,.364,.184)],[.7,new THREE.Color(.969,.516,.063)],[.8,new THREE.Color(.988,.683,.072)],[.9,new THREE.Color(.961,.859,.298)],[1,new THREE.Color(.988,.998,.645)]],GRAYSCALE:[[0,new THREE.Color(0,0,0)],[1,new THREE.Color(1,
1,1)]]},ea={};ea.vertex='\nprecision highp float;\nprecision highp int;\n\n#define MAX_CLIP_POLYGONS 8\n\n'+THREE.ShaderChunk.common+'\n'+THREE.ShaderChunk.logdepthbuf_pars_vertex+'\n\nattribute vec3 position;\nattribute vec3 color;\nattribute float intensity;\nattribute float classification;\nattribute float returnNumber;\nattribute float numberOfReturns;\nattribute float pointSourceID;\nattribute vec4 indices;\nattribute float spacing;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 uViewInv;\n\nuniform float uScreenWidth;\nuniform float uScreenHeight;\nuniform float fov;\nuniform float near;\nuniform float far;\n\nuniform bool uDebug;\n\nuniform bool uUseOrthographicCamera;\nuniform float uOrthoWidth;\nuniform float uOrthoHeight;\n\n#define CLIPTASK_NONE 0\n#define CLIPTASK_HIGHLIGHT 1\n#define CLIPTASK_SHOW_INSIDE 2\n#define CLIPTASK_SHOW_OUTSIDE 3\n\n#define CLIPMETHOD_INSIDE_ANY 0\n#define CLIPMETHOD_INSIDE_ALL 1\n\nuniform int clipTask;\nuniform int clipMethod;\n\n#if defined(num_clipboxes)\n#if num_clipboxes > 0\n\tuniform mat4 clipBoxes[num_clipboxes];\n#endif\n#endif\n\n#if defined(num_clipspheres)\n#if num_clipspheres > 0\n\tuniform mat4 uClipSpheres[num_clipspheres];\n#endif\n#endif\n\n#if defined(num_clippolygons)\n#if num_clippolygons > 0\n\tuniform int uClipPolygonVCount[num_clippolygons];\n\tuniform vec3 uClipPolygonVertices[num_clippolygons * 8];\n\tuniform mat4 uClipPolygonWVP[num_clippolygons];\n#endif\n#endif\n\nuniform float size;\nuniform float minSize;\nuniform float maxSize;\n\nuniform float uPCIndex;\nuniform float uOctreeSpacing;\nuniform float uNodeSpacing;\nuniform float uOctreeSize;\nuniform vec3 uBBSize;\nuniform float uLevel;\nuniform float uVNStart;\nuniform bool uIsLeafNode;\n\nuniform vec3 uColor;\nuniform float uOpacity;\n\nuniform vec2 elevationRange;\nuniform vec2 intensityRange;\nuniform float intensityGamma;\nuniform float intensityContrast;\nuniform float intensityBrightness;\nuniform float rgbGamma;\nuniform float rgbContrast;\nuniform float rgbBrightness;\nuniform float uTransition;\nuniform float wRGB;\nuniform float wIntensity;\nuniform float wElevation;\nuniform float wClassification;\nuniform float wReturnNumber;\nuniform float wSourceID;\n\nuniform vec3 uShadowColor;\n\nuniform sampler2D visibleNodes;\nuniform sampler2D gradient;\nuniform sampler2D classificationLUT;\n\n#if defined(num_shadowmaps)\n#if num_shadowmaps > 0\n\tuniform sampler2D uShadowMap[num_shadowmaps];\n\tuniform mat4 uShadowWorldView[num_shadowmaps];\n\tuniform mat4 uShadowProj[num_shadowmaps];\n#endif\n#endif\n\nvarying vec3 vColor;\nvarying float vLogDepth;\nvarying vec3 vViewPosition;\nvarying float vRadius;\nvarying float vPointSize;\n\nfloat round(float number)\n{\n\treturn floor(number + 0.5);\n}\n\n//---------------------\n//OCTREE\n//---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod))\n#if defined(tree_type_octree)\n\n\t/**\n\t * number of 1-bits up to inclusive index position\n\t * number is treated as if it were an integer in the range 0-255\n\t */\n\tint numberOfOnes(int number, int index)\n\t{\n\t\tint numOnes = 0;\n\t\tint tmp = 128;\n\n\t\tfor(int i = 7; i >= 0; i--)\n\t\t{\n\t\t\tif(number >= tmp)\n\t\t\t{\n\t\t\t\tnumber = number - tmp;\n\n\t\t\t\tif(i <= index)\n\t\t\t\t{\n\t\t\t\t\tnumOnes++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\ttmp = tmp / 2;\n\t\t}\n\n\t\treturn numOnes;\n\t}\n\n\t/**\n\t * checks whether the bit at index is 1\n\t * number is treated as if it were an integer in the range 0-255\n\t */\n\tbool isBitSet(int number, int index)\n\t{\n\t\t//weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0\n\t\tint powi = 1;\n\n\t\tif(index == 0)\n\t\t{\n\t\t\tpowi = 1;\n\t\t}\n\t\telse if(index == 1)\n\t\t{\n\t\t\tpowi = 2;\n\t\t}\n\t\telse if(index == 2)\n\t\t{\n\t\t\tpowi = 4;\n\t\t}\n\t\telse if(index == 3)\n\t\t{\n\t\t\tpowi = 8;\n\t\t}\n\t\telse if(index == 4)\n\t\t{\n\t\t\tpowi = 16;\n\t\t}\n\t\telse if(index == 5)\n\t\t{\n\t\t\tpowi = 32;\n\t\t}\n\t\telse if(index == 6)\n\t\t{\n\t\t\tpowi = 64;\n\t\t}\n\t\telse if(index == 7)\n\t\t{\n\t\t\tpowi = 128;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tint ndp = number / powi;\n\n\t\treturn mod(float(ndp), 2.0) != 0.0;\n\t}\n\n\t/**\n\t * find the LOD at the point position\n\t */\n\tfloat getLOD()\n\t{\n\t\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\t\tint iOffset = int(uVNStart);\n\t\tfloat depth = uLevel;\n\n\t\tfor(float i = 0.0; i <= 30.0; i++)\n\t\t{\n\t\t\tfloat nodeSizeAtLevel = uOctreeSize / pow(2.0, i + uLevel + 0.0);\n\t\t\t\n\t\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\t\tindex3d = floor(index3d + 0.5);\n\t\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\t\t\t\n\t\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\t\tint mask = int(round(value.r * 255.0));\n\n\t\t\tif(isBitSet(mask, index))\n\t\t\t{\n\t\t\t\t//there are more visible child nodes at this position\n\t\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\t\tiOffset = iOffset + advance;\n\t\t\t\t\n\t\t\t\tdepth++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//no more visible child nodes at this position\n\t\t\t\treturn value.a * 255.0;\n\t\t\t\t//return depth;\n\t\t\t}\n\t\t\t\n\t\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t\t}\n\t\t\t\n\t\treturn depth;\n\t}\n\n\tfloat getSpacing()\n\t{\n\t\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\t\tint iOffset = int(uVNStart);\n\t\tfloat depth = uLevel;\n\t\tfloat spacing = uNodeSpacing;\n\n\t\tfor(float i = 0.0; i <= 30.0; i++)\n\t\t{\n\t\t\tfloat nodeSizeAtLevel = uOctreeSize / pow(2.0, i + uLevel + 0.0);\n\t\t\t\n\t\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\t\tindex3d = floor(index3d + 0.5);\n\t\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\t\t\t\n\t\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\t\tint mask = int(round(value.r * 255.0));\n\t\t\tfloat spacingFactor = value.a;\n\n\t\t\tif(i > 0.0)\n\t\t\t{\n\t\t\t\tspacing = spacing / (255.0 * spacingFactor);\n\t\t\t}\n\t\t\t\n\t\t\tif(isBitSet(mask, index))\n\t\t\t{\n\t\t\t\t//there are more visible child nodes at this position\n\t\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\t\tiOffset = iOffset + advance;\n\n\t\t\t\tdepth++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//no more visible child nodes at this position\n\t\t\t\treturn spacing;\n\t\t\t}\n\t\t\t\n\t\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t\t}\n\t\t\t\n\t\treturn spacing;\n\t}\n\n\tfloat getPointSizeAttenuation()\n\t{\n\t\treturn pow(2.0, getLOD());\n\t}\n#endif\n#endif\n\n//---------------------\n//KD-TREE\n//---------------------\n#if (defined(adaptive_point_size) || defined(color_type_lod))\n#if defined(tree_type_kdtree)\n\tfloat getLOD()\n\t{\n\t\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\t\tfloat iOffset = 0.0;\n\t\tfloat depth = 0.0;\n\t\t\t\n\t\tvec3 size = uBBSize;\t\n\t\tvec3 pos = position;\n\t\t\t\n\t\tfor(float i = 0.0; i <= 1000.0; i++)\n\t\t{\n\t\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n\t\t\t\n\t\t\tint children = int(value.r * 255.0);\n\t\t\tfloat next = value.g * 255.0;\n\t\t\tint split = int(value.b * 255.0);\n\t\t\t\n\t\t\tif(next == 0.0)\n\t\t\t{\n\t\t\t \treturn depth;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\n\t\t\tif(split == 1)\n\t\t\t{\n\t\t\t\tsplitv.x = 1.0;\n\t\t\t}\n\t\t\telse if(split == 2)\n\t\t\t{\n\t\t\t \tsplitv.y = 1.0;\n\t\t\t}\n\t\t\telse if(split == 4)\n\t\t\t{\n\t\t\t \tsplitv.z = 1.0;\n\t\t\t}\n\t\t\t\n\t\t\tiOffset = iOffset + next;\n\t\t\t\n\t\t\tfloat factor = length(pos * splitv / size);\n\n\t\t\t//Left\n\t\t\tif(factor < 0.5)\n\t\t\t{\n\t\t\t\tif(children == 0 || children == 2)\n\t\t\t\t{\n\t\t\t\t\treturn depth;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//Right\n\t\t\telse\n\t\t\t{\n\t\t\t\tpos = pos - size * splitv * 0.5;\n\t\t\t\tif(children == 0 || children == 1)\n\t\t\t\t{\n\t\t\t\t\treturn depth;\n\t\t\t\t}\n\t\t\t\tif(children == 3)\n\t\t\t\t{\n\t\t\t\t\tiOffset = iOffset + 1.0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\n\t\t\tdepth++;\n\t\t}\n\t\t\t\n\t\treturn depth;\t\n\t}\n\n\tfloat getPointSizeAttenuation()\n\t{\n\t\treturn 0.5 * pow(1.3, getLOD());\n\t}\n#endif\n#endif\n\n//formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\nfloat getContrastFactor(float contrast)\n{\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\n}\n\nvec3 getRGB()\n{\n\tvec3 rgb = color;\n\t\n\trgb = pow(rgb, vec3(rgbGamma));\n\trgb = rgb + rgbBrightness;\n\trgb = clamp(rgb, 0.0, 1.0);\n\t\n\treturn rgb;\n}\n\nfloat getIntensity()\n{\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\n\tw = pow(w, intensityGamma);\n\tw = w + intensityBrightness;\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\n\tw = clamp(w, 0.0, 1.0);\n\n\treturn w;\n}\n\nvec3 getElevation()\n{\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\n\tfloat w = (world.z - elevationRange.x) / (elevationRange.y - elevationRange.x);\n\treturn texture2D(gradient, vec2(w,1.0-w)).rgb;\n}\n\nvec4 getClassification()\n{\n\tvec2 uv = vec2(classification / 255.0, 0.5);\n\treturn texture2D(classificationLUT, uv);\n}\n\nvec3 getReturnNumber()\n{\n\tif(numberOfReturns == 1.0)\n\t{\n\t\treturn vec3(1.0, 1.0, 0.0);\n\t}\n\telse\n\t{\n\t\tif(returnNumber == 1.0)\n\t\t{\n\t\t\treturn vec3(1.0, 0.0, 0.0);\n\t\t}\n\t\telse if(returnNumber == numberOfReturns)\n\t\t{\n\t\t\treturn vec3(0.0, 0.0, 1.0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn vec3(0.0, 1.0, 0.0);\n\t\t}\n\t}\n}\n\nvec3 getSourceID()\n{\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\n\treturn texture2D(gradient, vec2(w,1.0 - w)).rgb;\n}\n\nvec3 getCompositeColor()\n{\n\tvec3 c;\n\tfloat w;\n\n\tc += wRGB * getRGB();\n\tw += wRGB;\n\t\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\n\tw += wIntensity;\n\t\n\tc += wElevation * getElevation();\n\tw += wElevation;\n\t\n\tc += wReturnNumber * getReturnNumber();\n\tw += wReturnNumber;\n\t\n\tc += wSourceID * getSourceID();\n\tw += wSourceID;\n\t\n\tvec4 cl = wClassification * getClassification();\n    c += cl.a * cl.rgb;\n\tw += wClassification * cl.a;\n\n\tc = c / w;\n\t\n\tif(w == 0.0)\n\t{\n\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t}\n\t\n\treturn c;\n}\n\nvec3 getColor()\n{\n\tvec3 color;\n\t\n\t#ifdef color_type_rgb\n\t\tcolor = getRGB();\n\t#elif defined color_type_height\n\t\tcolor = getElevation();\n\t#elif defined color_type_rgb_height\n\t\tvec3 cHeight = getElevation();\n\t\tcolor = (1.0 - uTransition) * getRGB() + uTransition * cHeight;\n\t#elif defined color_type_depth\n\t\tfloat linearDepth = gl_Position.w;\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\n\t\tcolor = vec3(linearDepth, expDepth, 0.0);\n\t#elif defined color_type_intensity\n\t\tfloat w = getIntensity();\n\t\tcolor = vec3(w, w, w);\n\t#elif defined color_type_intensity_gradient\n\t\tfloat w = getIntensity();\n\t\tcolor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_color\n\t\tcolor = uColor;\n\t#elif defined color_type_lod\n\t\tfloat depth = getLOD();\n\t\tfloat w = depth / 10.0;\n\t\tcolor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_point_index\n\t\tcolor = indices.rgb;\n\t#elif defined color_type_classification\n\t\tvec4 cl = getClassification(); \n\t\tcolor = cl.rgb;\n\t#elif defined color_type_return_number\n\t\tcolor = getReturnNumber();\n\t#elif defined color_type_source\n\t\tcolor = getSourceID();\n\t#elif defined color_type_normal\n\t\tcolor = (modelMatrix * vec4(normal, 0.0)).xyz;\n\t#elif defined color_type_phong\n\t\tcolor = color;\n\t#elif defined color_type_composite\n\t\tcolor = getCompositeColor();\n\t#endif\n\t\n\treturn color;\n}\n\nfloat getPointSize()\n{\n\tfloat pointSize = 1.0;\n\t\n\tfloat slope = tan(fov / 2.0);\n\tfloat projFactor = -0.5 * uScreenHeight / (slope * vViewPosition.z);\n\t\n\tfloat r = uOctreeSpacing * 1.7;\n\tvRadius = r;\n\n\t#if defined fixed_point_size\n\t\tpointSize = size;\n\t#elif defined attenuated_point_size\n\t\tif(uUseOrthographicCamera)\n\t\t{\n\t\t\tpointSize = size;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpointSize = size * spacing * projFactor;\n\t\t}\n\t#elif defined adaptive_point_size\n\t\tif(uUseOrthographicCamera)\n\t\t{\n\t\t\tfloat worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();\n\t\t\tpointSize = (worldSpaceSize / uOrthoWidth) * uScreenWidth;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(uIsLeafNode && false)\n\t\t\t{\n\t\t\t\tpointSize = size * spacing * projFactor;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfloat worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();\n\t\t\t\tpointSize = worldSpaceSize * projFactor;\n\t\t\t}\n\t\t}\n\t#endif\n\n\tpointSize = max(minSize, pointSize);\n\tpointSize = min(maxSize, pointSize);\n\t\n\tvRadius = pointSize / projFactor;\n\n\treturn pointSize;\n}\n\n#if defined num_clippolygons\n#if num_clippolygons > 0\n\tbool pointInClipPolygon(vec3 point, int polyIdx)\n\t{\n\t\tmat4 wvp = uClipPolygonWVP[polyIdx];\n\n\t\tvec4 pointNDC = wvp * vec4(point, 1.0);\n\t\tpointNDC.xy = pointNDC.xy / pointNDC.w;\n\n\t\tint j = uClipPolygonVCount[polyIdx] - 1;\n\t\tbool c = false;\n\t\tfor(int i = 0; i < 8; i++)\n\t\t{\n\t\t\tif(i == uClipPolygonVCount[polyIdx])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvec3 verti = uClipPolygonVertices[polyIdx * 8 + i];\n\t\t\tvec3 vertj = uClipPolygonVertices[polyIdx * 8 + j];\n\n\t\t\tif(((verti.y > pointNDC.y) != (vertj.y > pointNDC.y)) && (pointNDC.x < (vertj.x-verti.x) * (pointNDC.y-verti.y) / (vertj.y-verti.y) + verti.x))\n\t\t\t{\n\t\t\t\tc = !c;\n\t\t\t}\n\n\t\t\tj = i;\n\t\t}\n\n\t\treturn c;\n\t}\n#endif\n#endif\n\nvoid doClipping()\n{\n\t#if !defined color_type_composite\n\t\tvec4 cl = getClassification(); \n\t\tif(cl.a == 0.0)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t#endif\n\n\tint clipVolumesCount = 0;\n\tint insideCount = 0;\n\n\t#if defined(num_clipboxes)\n\t#if num_clipboxes > 0\n\t\tfor(int i = 0; i < num_clipboxes; i++)\n\t\t{\n\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );\n\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\n\n\t\t\tinsideCount = insideCount + (inside ? 1 : 0);\n\t\t\tclipVolumesCount++;\n\t\t}\t\n\t#endif\n\t#endif\n\n\t#if defined(num_clippolygons)\n\t#if num_clippolygons > 0\n\t\tfor(int i = 0; i < num_clippolygons; i++)\n\t\t{\n\t\t\tbool inside = pointInClipPolygon(position, i);\n\n\t\t\tinsideCount = insideCount + (inside ? 1 : 0);\n\t\t\tclipVolumesCount++;\n\t\t}\n\t#endif\n\t#endif\n\n\tbool insideAny = insideCount > 0;\n\tbool insideAll = (clipVolumesCount > 0) && (clipVolumesCount == insideCount);\n\n\tif(clipMethod == CLIPMETHOD_INSIDE_ANY)\n\t{\n\t\tif(insideAny && clipTask == CLIPTASK_HIGHLIGHT)\n\t\t{\n\t\t\tvColor.r += 0.5;\n\t\t}\n\t\telse if(!insideAny && clipTask == CLIPTASK_SHOW_INSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t\telse if(insideAny && clipTask == CLIPTASK_SHOW_OUTSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t}\n\telse if(clipMethod == CLIPMETHOD_INSIDE_ALL)\n\t{\n\t\tif(insideAll && clipTask == CLIPTASK_HIGHLIGHT)\n\t\t{\n\t\t\tvColor.r += 0.5;\n\t\t}\n\t\telse if(!insideAll && clipTask == CLIPTASK_SHOW_INSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t\telse if(insideAll && clipTask == CLIPTASK_SHOW_OUTSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t}\n}\n\nvoid main()\n{\n\tvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n\tvViewPosition = mvPosition.xyz;\n\tgl_Position = projectionMatrix * mvPosition;\n\n\tvLogDepth = log2(-mvPosition.z);\n\n\t//POINT SIZE\n\tfloat pointSize = getPointSize();\n\tgl_PointSize = pointSize;\n\tvPointSize = pointSize;\n\n\t'+
THREE.ShaderChunk.logdepthbuf_vertex+'\n\n\t//COLOR\n\tvColor = getColor();\n\n\t#if defined hq_depth_pass\n\t\tfloat originalDepth = gl_Position.w;\n\t\tfloat adjustedDepth = originalDepth + 2.0 * vRadius;\n\t\tfloat adjust = adjustedDepth / originalDepth;\n\n\t\tmvPosition.xyz = mvPosition.xyz * adjust;\n\t\tgl_Position = projectionMatrix * mvPosition;\n\t#endif\n\n\t//CLIPPING\n\tdoClipping();\n\n\t#if defined num_clipspheres\n\t#if num_clipspheres > 0\n\t\tfor(int i = 0; i < num_clipspheres; i++)\n\t\t{\n\t\t\tvec4 sphereLocal = uClipSpheres[i] * mvPosition;\n\n\t\t\tfloat distance = length(sphereLocal.xyz);\n\n\t\t\tif(distance < 1.0)\n\t\t\t{\n\t\t\t\tfloat w = distance;\n\t\t\t\tvec3 cGradient = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\n\t\t\t\t\n\t\t\t\tvColor = cGradient;\n\t\t\t}\n\t\t}\n\t#endif\n\t#endif\n\n\t#if defined num_shadowmaps\n\t#if num_shadowmaps > 0\n\n\t\tconst float sm_near = 0.1;\n\t\tconst float sm_far = 10000.0;\n\n\t\tfor(int i = 0; i < num_shadowmaps; i++)\n\t\t{\n\t\t\tvec3 viewPos = (uShadowWorldView[i] * vec4(position, 1.0)).xyz;\n\t\t\tfloat distanceToLight = abs(viewPos.z);\n\t\t\t\n\t\t\tvec4 projPos = uShadowProj[i] * uShadowWorldView[i] * vec4(position, 1);\n\t\t\tvec3 nc = projPos.xyz / projPos.w;\n\t\t\t\n\t\t\tfloat u = nc.x * 0.5 + 0.5;\n\t\t\tfloat v = nc.y * 0.5 + 0.5;\n\n\t\t\tvec2 sampleStep = vec2(1.0 / (2.0*1024.0), 1.0 / (2.0*1024.0)) * 1.5;\n\t\t\tvec2 sampleLocations[9];\n\n\t\t\tsampleLocations[0] = vec2(0.0, 0.0);\n\t\t\tsampleLocations[1] = sampleStep;\n\t\t\tsampleLocations[2] = -sampleStep;\n\t\t\tsampleLocations[3] = vec2(sampleStep.x, -sampleStep.y);\n\t\t\tsampleLocations[4] = vec2(-sampleStep.x, sampleStep.y);\n\t\t\tsampleLocations[5] = vec2(0.0, sampleStep.y);\n\t\t\tsampleLocations[6] = vec2(0.0, -sampleStep.y);\n\t\t\tsampleLocations[7] = vec2(sampleStep.x, 0.0);\n\t\t\tsampleLocations[8] = vec2(-sampleStep.x, 0.0);\n\n\t\t\tfloat visibleSamples = 0.0;\n\t\t\tfloat numSamples = 0.0;\n\n\t\t\tfloat bias = vRadius * 2.0;\n\n\t\t\tfor(int j = 0; j < 9; j++)\n\t\t\t{\n\t\t\t\tvec4 depthMapValue = texture2D(uShadowMap[i], vec2(u, v) + sampleLocations[j]);\n\n\t\t\t\tfloat linearDepthFromSM = depthMapValue.x + bias;\n\t\t\t\tfloat linearDepthFromViewer = distanceToLight;\n\n\t\t\t\tif(linearDepthFromSM > linearDepthFromViewer)\n\t\t\t\t{\n\t\t\t\t\tvisibleSamples += 1.0;\n\t\t\t\t}\n\n\t\t\t\tnumSamples += 1.0;\n\t\t\t}\n\n\t\t\tfloat visibility = visibleSamples / numSamples;\n\n\t\t\tif(u < 0.0 || u > 1.0 || v < 0.0 || v > 1.0 || nc.x < -1.0 || nc.x > 1.0 || nc.y < -1.0 || nc.y > 1.0 || nc.z < -1.0 || nc.z > 1.0)\n\t\t\t{\n\t\t\t\t//vColor = vec3(0.0, 0.0, 0.2);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvColor = vColor * visibility + vColor * uShadowColor * (1.0 - visibility);\n\t\t\t}\n\t\t}\n\n\t#endif\n\t#endif\n}';
ea.fragment='\n\n#if defined USE_LOGDEPTHBUF_EXT || defined paraboloid_point_shape\n\t#extension GL_EXT_frag_depth : enable\n#endif\n\nprecision highp float;\nprecision highp int;\n\n'+THREE.ShaderChunk.common+'\n'+THREE.ShaderChunk.logdepthbuf_pars_fragment+'\n\nuniform mat4 viewMatrix;\nuniform mat4 uViewInv;\nuniform mat4 uProjInv;\nuniform vec3 cameraPosition;\n\nuniform mat4 projectionMatrix;\nuniform float uOpacity;\n\nuniform float blendHardness;\nuniform float blendDepthSupplement;\nuniform float fov;\nuniform float uSpacing;\nuniform float near;\nuniform float far;\nuniform float uPCIndex;\nuniform float uScreenWidth;\nuniform float uScreenHeight;\n\nvarying vec3 vColor;\nvarying float vLogDepth;\nvarying vec3 vViewPosition;\nvarying float vRadius;\nvarying float vPointSize;\nvarying vec3 vPosition;\n\nvoid main()\n{\n\tvec3 color = vColor;\n\tfloat depth = gl_FragCoord.z;\n\n\t#if defined circle_point_shape || defined paraboloid_point_shape\n\t\tfloat u = (2.0 * gl_PointCoord.x) - 1.0;\n\t\tfloat v = (2.0 * gl_PointCoord.y) - 1.0;\n\t#endif\n\t\n\t#if defined circle_point_shape\n\t\tfloat cc = (u*u) + (v*v);\n\t\tif(cc > 1.0)\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\n\t#if defined color_type_point_index\n\t\tgl_FragColor = vec4(color, uPCIndex / 255.0);\n\t#else\n\t\tgl_FragColor = vec4(color, uOpacity);\n\t#endif\n\n\t#if defined paraboloid_point_shape\n\t\tfloat wi = -( u*u + v*v);\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\n\t\tpos.z += wi * vRadius;\n\t\tfloat linearDepth = -pos.z;\n\t\tpos = projectionMatrix * pos;\n\t\tpos = pos / pos.w;\n\t\tfloat expDepth = pos.z;\n\t\tdepth = (pos.z + 1.0) / 2.0;\n\n\t\tgl_FragDepthEXT = depth;\n\t\t\n\t\t#if defined color_type_depth\n\t\t\tcolor.r = linearDepth;\n\t\t\tcolor.g = expDepth;\n\t\t#endif\n\t#endif\n\t\n\t'+
THREE.ShaderChunk.logdepthbuf_fragment+'\n\n\t#if defined weighted_splats\n\t\tfloat distance = 2.0 * length(gl_PointCoord.xy - 0.5);\n\t\tfloat weight = max(0.0, 1.0 - distance);\n\t\tweight = pow(weight, 1.5);\n\n\t\tgl_FragColor.a = weight;\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * weight;\n\t#endif\n}';var F=function(c){c=void 0===c?{}:c;var a=THREE.RawShaderMaterial.call(this)||this;a.visibleNodesTexture=Z.generateDataTexture(2048,1,new THREE.Color(16777215));a.visibleNodesTexture.minFilter=
THREE.NearestFilter;a.visibleNodesTexture.magFilter=THREE.NearestFilter;var d=function(a,c){return void 0!==a?a:c},b=d(c.size,1),f=d(c.minSize,2),e=d(c.maxSize,50);c=d(c.treeType,na.OCTREE);a._pointSizeType=fa.FIXED;a._shape=oa.SQUARE;a._pointColorType=H.RGB;a._useClipBox=!1;a._weighted=!1;a._gradient=Ha.SPECTRAL;a._treeType=c;a._useEDL=!1;a._snapEnabled=!1;a._numSnapshots=0;a._defaultIntensityRangeChanged=!1;a._defaultElevationRangeChanged=!1;a.clipBoxes=[];a.clipPolygons=[];a.gradientTexture=F.generateGradientTexture(a._gradient);
a.lights=!1;a.fog=!1;a.defines=new Map;a.attributes={position:{type:'fv',value:[]},color:{type:'fv',value:[]},normal:{type:'fv',value:[]},intensity:{type:'f',value:[]},classification:{type:'f',value:[]},returnNumber:{type:'f',value:[]},numberOfReturns:{type:'f',value:[]},pointSourceID:{type:'f',value:[]},indices:{type:'fv',value:[]}};a.uniforms={level:{type:'f',value:0},vnStart:{type:'f',value:0},spacing:{type:'f',value:1},blendHardness:{type:'f',value:2},blendDepthSupplement:{type:'f',value:0},fov:{type:'f',
value:1},screenWidth:{type:'f',value:1},screenHeight:{type:'f',value:1},near:{type:'f',value:.1},far:{type:'f',value:1},uColor:{type:'c',value:new THREE.Color(16777215)},uOpacity:{type:'f',value:1},size:{type:'f',value:b},minSize:{type:'f',value:f},maxSize:{type:'f',value:e},octreeSize:{type:'f',value:0},bbSize:{type:'fv',value:[0,0,0]},elevationRange:{type:'2fv',value:[0,0]},clipBoxCount:{type:'f',value:0},clipPolygonCount:{type:'i',value:0},clipBoxes:{type:'Matrix4fv',value:[]},clipPolygons:{type:'3fv',
value:[]},clipPolygonVCount:{type:'iv',value:[]},clipPolygonVP:{type:'Matrix4fv',value:[]},visibleNodes:{type:'t',value:a.visibleNodesTexture},pcIndex:{type:'f',value:0},gradient:{type:'t',value:a.gradientTexture},classificationLUT:{type:'t',value:a.classificationTexture},uHQDepthMap:{type:'t',value:null},toModel:{type:'Matrix4f',value:[]},diffuse:{type:'fv',value:[1,1,1]},transition:{type:'f',value:.5},intensityRange:{type:'fv',value:[0,65E3]},intensityGamma:{type:'f',value:1},intensityContrast:{type:'f',
value:0},intensityBrightness:{type:'f',value:0},rgbGamma:{type:'f',value:1},rgbContrast:{type:'f',value:0},rgbBrightness:{type:'f',value:0},wRGB:{type:'f',value:1},wIntensity:{type:'f',value:0},wElevation:{type:'f',value:0},wClassification:{type:'f',value:0},wReturnNumber:{type:'f',value:0},wSourceID:{type:'f',value:0},useOrthographicCamera:{type:'b',value:!1},clipTask:{type:'i',value:1},clipMethod:{type:'i',value:1},uSnapshot:{type:'tv',value:[]},uSnapshotDepth:{type:'tv',value:[]},uSnapView:{type:'Matrix4fv',
value:[]},uSnapProj:{type:'Matrix4fv',value:[]},uSnapProjInv:{type:'Matrix4fv',value:[]},uSnapViewInv:{type:'Matrix4fv',value:[]},uShadowColor:{type:'3fv',value:[0,0,0]},uFilterReturnNumberRange:{type:'fv',value:[0,7]},uFilterNumberOfReturnsRange:{type:'fv',value:[0,7]},uFilterGPSTimeClipRange:{type:'fv',value:[0,7]}};a.classification=Ia.DEFAULT;a.defaultAttributeValues.normal=[0,0,0];a.defaultAttributeValues.classification=[0,0,0];a.defaultAttributeValues.indices=[0,0,0,0];b=a.getDefines();a.vertexShader=
b+ea.vertex;a.fragmentShader=b+ea.fragment;a.vertexColors=THREE.VertexColors;return a};$jscomp.inherits(F,THREE.RawShaderMaterial);F.prototype.setDefine=function(c,a){void 0!==a&&null!==a?this.defines.get(c)!==a&&(this.defines.set(c,a),this.updateShaderSource()):this.removeDefine(c)};F.prototype.removeDefine=function(c){this.defines.delete(c)};F.prototype.updateShaderSource=function(){var c=this.getDefines();this.vertexShader=c+ea.vertex;this.fragmentShader=c+ea.fragment;1===this.opacity?(this.blending=
THREE.NoBlending,this.transparent=!1,this.depthWrite=this.depthTest=!0,this.depthFunc=THREE.LessEqualDepth):1>this.opacity&&!this.useEDL&&(this.blending=THREE.AdditiveBlending,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0,this.depthFunc=THREE.AlwaysDepth);this.weighted&&(this.blending=THREE.AdditiveBlending,this.depthTest=this.transparent=!0,this.depthWrite=!1);this.needsUpdate=!0};F.prototype.onBeforeCompile=function(c,a){a.capabilities.logarithmicDepthBuffer&&(c.fragmentShader='#define USE_LOGDEPTHBUF\n#define USE_LOGDEPTHBUF_EXT\n#define EPSILON 1e-6\n'+
c.fragmentShader,c.vertexShader='#define USE_LOGDEPTHBUF\n#define USE_LOGDEPTHBUF_EXT\n#define EPSILON 1e-6\n'+c.vertexShader)};F.prototype.getDefines=function(){var c=[];this.pointSizeType===fa.FIXED?c.push('#define fixed_point_size'):this.pointSizeType===fa.ATTENUATED?c.push('#define attenuated_point_size'):this.pointSizeType===fa.ADAPTIVE&&c.push('#define adaptive_point_size');this.shape===oa.SQUARE?c.push('#define square_point_shape'):this.shape===oa.CIRCLE?c.push('#define circle_point_shape'):
this.shape===oa.PARABOLOID&&c.push('#define paraboloid_point_shape');this._useEDL&&c.push('#define use_edl');this._snapEnabled&&c.push('#define snap_enabled');this._pointColorType===H.RGB?c.push('#define color_type_rgb'):this._pointColorType===H.COLOR?c.push('#define color_type_color'):this._pointColorType===H.DEPTH?c.push('#define color_type_depth'):this._pointColorType===H.HEIGHT?c.push('#define color_type_height'):this._pointColorType===H.INTENSITY?c.push('#define color_type_intensity'):this._pointColorType===
H.INTENSITY_GRADIENT?c.push('#define color_type_intensity_gradient'):this._pointColorType===H.LOD?c.push('#define color_type_lod'):this._pointColorType===H.POINT_INDEX?c.push('#define color_type_point_index'):this._pointColorType===H.CLASSIFICATION?c.push('#define color_type_classification'):this._pointColorType===H.RETURN_NUMBER?c.push('#define color_type_return_number'):this._pointColorType===H.SOURCE?c.push('#define color_type_source'):this._pointColorType===H.NORMAL?c.push('#define color_type_normal'):
this._pointColorType===H.PHONG?c.push('#define color_type_phong'):this._pointColorType===H.RGB_HEIGHT?c.push('#define color_type_rgb_height'):this._pointColorType===H.COMPOSITE&&c.push('#define color_type_composite');this._treeType===na.OCTREE?c.push('#define tree_type_octree'):this._treeType===na.KDTREE&&c.push('#define tree_type_kdtree');this.weighted&&c.push('#define weighted_splats');for(var a=$jscomp.makeIterator(this.defines),d=a.next();!d.done;d=a.next())d=$jscomp.makeIterator(d.value),d.next(),
d=d.next().value,c.push(d);return c.join('\n')};F.prototype.setClipBoxes=function(c){if(c){var a=this.clipBoxes.length!==c.length&&(0===c.length||0===this.clipBoxes.length);this.uniforms.clipBoxCount.value=this.clipBoxes.length;this.clipBoxes=c;a&&this.updateShaderSource();this.uniforms.clipBoxes.value=new Float32Array(16*this.clipBoxes.length);for(a=0;a<this.clipBoxes.length;a++)this.uniforms.clipBoxes.value.set(c[a].inverse.elements,16*a);for(a=0;a<this.uniforms.clipBoxes.value.length;a++)Number.isNaN(this.uniforms.clipBoxes.value[a])&&
(this.uniforms.clipBoxes.value[a]=Infinity)}};F.prototype.setClipPolygons=function(c,a){c&&(this.clipPolygons=c,this.clipPolygons.length!==c.length&&this.updateShaderSource())};F.prototype.recomputeClassification=function(){this.classificationTexture=F.generateClassificationTexture(this._classification);this.uniforms.classificationLUT.value=this.classificationTexture;this.dispatchEvent({type:'material_property_changed',target:this})};F.generateGradientTexture=function(c){var a=document.createElement('canvas');
a.width=64;a.height=64;var d=a.getContext('2d');d.rect(0,0,64,64);for(var b=d.createLinearGradient(0,0,64,64),f=0;f<c.length;f++){var e=c[f];b.addColorStop(e[0],'#'+e[1].getHexString())}d.fillStyle=b;d.fill();c=new THREE.CanvasTexture(a);c.needsUpdate=!0;c.minFilter=THREE.LinearFilter;return c};F.generateClassificationTexture=function(c){for(var a=new Uint8Array(262144),d=0;256>d;d++)for(var b=0;256>b;b++){var f=d+256*b;var e=c[d]?c[d]:c[d%32]?c[d%32]:c.DEFAULT;a[4*f]=255*e.x;a[4*f+1]=255*e.y;a[4*
f+2]=255*e.z;a[4*f+3]=255*e.w}c=new THREE.DataTexture(a,256,256,THREE.RGBAFormat);c.magFilter=THREE.NearestFilter;c.needsUpdate=!0;return c};F.prototype.disableEvents=function(){void 0===this._hiddenListeners&&(this._hiddenListeners=this._listeners,this._listeners={})};F.prototype.enableEvents=function(){this._listeners=this._hiddenListeners;this._hiddenListeners=void 0};F.prototype.copyFrom=function(c){for(var a=$jscomp.makeIterator(this.uniforms),d=a.next();!d.done;d=a.next())d=d.value,this.uniforms[d].value=
c.uniforms[d].value};$jscomp.global.Object.defineProperties(F.prototype,{gradient:{configurable:!0,enumerable:!0,get:function(){return this._gradient},set:function(c){this._gradient!==c&&(this._gradient=c,this.gradientTexture=F.generateGradientTexture(this._gradient),this.uniforms.gradient.value=this.gradientTexture)}},useOrthographicCamera:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.useOrthographicCamera.value},set:function(c){this.uniforms.useOrthographicCamera.value!==c&&
(this.uniforms.useOrthographicCamera.value=c)}},classification:{configurable:!0,enumerable:!0,get:function(){return this._classification},set:function(c){for(var a={},d=$jscomp.makeIterator(Object.keys(c)),b=d.next();!b.done;b=d.next())b=b.value,a[b]=c[b].clone();if(void 0===this._classification)c=!1;else for(c=Object.keys(a).length===Object.keys(this._classification).length,d=$jscomp.makeIterator(Object.keys(a)),b=d.next();!b.done;b=d.next())b=b.value,c=(c=c&&void 0!==this._classification[b])&&a[b].equals(this._classification[b]);
c||(this._classification=a,this.recomputeClassification())}},numSnapshots:{configurable:!0,enumerable:!0,get:function(){return this._numSnapshots},set:function(c){this._numSnapshots=c}},snapEnabled:{configurable:!0,enumerable:!0,get:function(){return this._snapEnabled},set:function(c){this._snapEnabled!==c&&(this._snapEnabled=c,this.updateShaderSource())}},spacing:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.spacing.value},set:function(c){this.uniforms.spacing.value!==c&&(this.uniforms.spacing.value=
c)}},useClipBox:{configurable:!0,enumerable:!0,get:function(){return this._useClipBox},set:function(c){this._useClipBox!==c&&(this._useClipBox=c,this.updateShaderSource())}},clipTask:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.clipTask.value},set:function(c){this.uniforms.clipTask.value=c}},clipMethod:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.clipMethod.value},set:function(c){this.uniforms.clipMethod.value=c}},weighted:{configurable:!0,enumerable:!0,
get:function(){return this._weighted},set:function(c){this._weighted!==c&&(this._weighted=c,this.updateShaderSource())}},fov:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.fov.value},set:function(c){this.uniforms.fov.value!==c&&(this.uniforms.fov.value=c,this.updateShaderSource())}},screenWidth:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.screenWidth.value},set:function(c){this.uniforms.screenWidth.value!==c&&(this.uniforms.screenWidth.value=c,this.updateShaderSource())}},
screenHeight:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.screenHeight.value},set:function(c){this.uniforms.screenHeight.value!==c&&(this.uniforms.screenHeight.value=c,this.updateShaderSource())}},near:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.near.value},set:function(c){this.uniforms.near.value!==c&&(this.uniforms.near.value=c)}},far:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.far.value},set:function(c){this.uniforms.far.value!==
c&&(this.uniforms.far.value=c)}},opacity:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.uOpacity.value},set:function(c){this.uniforms&&this.uniforms.uOpacity&&this.uniforms.uOpacity.value!==c&&(this.uniforms.uOpacity.value=c,this.updateShaderSource(),this.dispatchEvent({type:'opacity_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},pointColorType:{configurable:!0,enumerable:!0,get:function(){return this._pointColorType},set:function(c){this._pointColorType!==
c&&(this._pointColorType=c,this.updateShaderSource(),this.dispatchEvent({type:'point_color_type_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},pointSizeType:{configurable:!0,enumerable:!0,get:function(){return this._pointSizeType},set:function(c){this._pointSizeType!==c&&(this._pointSizeType=c,this.updateShaderSource(),this.dispatchEvent({type:'point_size_type_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},
useEDL:{configurable:!0,enumerable:!0,get:function(){return this._useEDL},set:function(c){this._useEDL!==c&&(this._useEDL=c,this.updateShaderSource())}},color:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.uColor.value},set:function(c){this.uniforms.uColor.value.equals(c)||(this.uniforms.uColor.value.copy(c),this.dispatchEvent({type:'color_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},shape:{configurable:!0,enumerable:!0,get:function(){return this._shape},
set:function(c){this._shape!==c&&(this._shape=c,this.updateShaderSource(),this.dispatchEvent({type:'point_shape_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},treeType:{configurable:!0,enumerable:!0,get:function(){return this._treeType},set:function(c){this._treeType!==c&&(this._treeType=c,this.updateShaderSource())}},bbSize:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.bbSize.value},set:function(c){this.uniforms.bbSize.value=c}},
size:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.size.value},set:function(c){this.uniforms.size.value!==c&&(this.uniforms.size.value=c,this.dispatchEvent({type:'point_size_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}},elevationRange:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.elevationRange.value},set:function(c){if(this.uniforms.elevationRange.value[0]!==c[0]||this.uniforms.elevationRange.value[1]!==c[1])this.uniforms.elevationRange.value=
c,this._defaultElevationRangeChanged=!0,this.dispatchEvent({type:'material_property_changed',target:this})}},heightMin:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.elevationRange.value[0]},set:function(c){this.elevationRange=[c,this.elevationRange[1]]}},heightMax:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.elevationRange.value[1]},set:function(c){this.elevationRange=[this.elevationRange[0],c]}},transition:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.transition.value},
set:function(c){this.uniforms.transition.value=c}},intensityRange:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.intensityRange.value},set:function(c){c instanceof Array&&2===c.length&&(c[0]!==this.uniforms.intensityRange.value[0]||c[1]!==this.uniforms.intensityRange.value[1])&&(this.uniforms.intensityRange.value=c,this._defaultIntensityRangeChanged=!0,this.dispatchEvent({type:'material_property_changed',target:this}))}},intensityGamma:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.intensityGamma.value},
set:function(c){this.uniforms.intensityGamma.value!==c&&(this.uniforms.intensityGamma.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},intensityContrast:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.intensityContrast.value},set:function(c){this.uniforms.intensityContrast.value!==c&&(this.uniforms.intensityContrast.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},intensityBrightness:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.intensityBrightness.value},
set:function(c){this.uniforms.intensityBrightness.value!==c&&(this.uniforms.intensityBrightness.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},rgbGamma:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.rgbGamma.value},set:function(c){this.uniforms.rgbGamma.value!==c&&(this.uniforms.rgbGamma.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},rgbContrast:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.rgbContrast.value},
set:function(c){this.uniforms.rgbContrast.value!==c&&(this.uniforms.rgbContrast.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},rgbBrightness:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.rgbBrightness.value},set:function(c){this.uniforms.rgbBrightness.value!==c&&(this.uniforms.rgbBrightness.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightRGB:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wRGB.value},
set:function(c){this.uniforms.wRGB.value!==c&&(this.uniforms.wRGB.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightIntensity:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wIntensity.value},set:function(c){this.uniforms.wIntensity.value!==c&&(this.uniforms.wIntensity.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightElevation:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wElevation.value},
set:function(c){this.uniforms.wElevation.value!==c&&(this.uniforms.wElevation.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightClassification:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wClassification.value},set:function(c){this.uniforms.wClassification.value!==c&&(this.uniforms.wClassification.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightReturnNumber:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wReturnNumber.value},
set:function(c){this.uniforms.wReturnNumber.value!==c&&(this.uniforms.wReturnNumber.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}},weightSourceID:{configurable:!0,enumerable:!0,get:function(){return this.uniforms.wSourceID.value},set:function(c){this.uniforms.wSourceID.value!==c&&(this.uniforms.wSourceID.value=c,this.dispatchEvent({type:'material_property_changed',target:this}))}}});var Q=function(){this.needsTransformUpdate=!0;this.children={};this.octree=this.sceneNode=
null;return this};$jscomp.inherits(Q,J);Q.prototype.getNumPoints=function(){return this.geometryNode.numPoints};Q.prototype.isLoaded=function(){return!0};Q.prototype.isTreeNode=function(){return!0};Q.prototype.isGeometryNode=function(){return!1};Q.prototype.getLevel=function(){return this.geometryNode.level};Q.prototype.getBoundingSphere=function(){return this.geometryNode.boundingSphere};Q.prototype.getBoundingBox=function(){return this.geometryNode.boundingBox};Q.prototype.getChildren=function(){for(var c=
[],a=0;8>a;a++)this.children[a]&&c.push(this.children[a]);return c};Q.prototype.getPointsInBox=function(c){if(!this.sceneNode)return null;var a=this.geometryNode.buffer,d=a.offset('position'),b=a.stride,f=new DataView(a.data);c=(new THREE.Matrix4).getInverse(c.matrixWorld);c=(new THREE.Matrix4).multiplyMatrices(c,this.sceneNode.matrixWorld);for(var e=[],k=new THREE.Vector4,u=0;u<a.numElements;u++){var r=f.getFloat32(u*b+d+0,!0),q=f.getFloat32(u*b+d+4,!0),n=f.getFloat32(u*b+d+8,!0);k.set(r,q,n,1);
k.applyMatrix4(c);-.5<k.x&&.5>k.x&&-.5<k.y&&.5>k.y&&-.5<k.z&&.5>k.z&&(k.set(r,q,n,1).applyMatrix4(this.sceneNode.matrixWorld),e.push(new THREE.Vector3(k.x,k.y,k.z)))}return e};$jscomp.global.Object.defineProperties(Q.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.geometryNode.name}}});var B=function(c,a){var d=Y.call(this)||this;d.pointBudget=Infinity;d.pcoGeometry=c;d.boundingBox=d.pcoGeometry.boundingBox;d.boundingSphere=d.boundingBox.getBoundingSphere(new THREE.Sphere);
d.material=a||new F;d.visiblePointsTarget=2E6;d.minimumNodePixelSize=150;d.level=0;d.position.copy(c.offset);d.updateMatrix();d.showBoundingBox=!1;d.boundingBoxNodes=[];d.loadQueue=[];d.visibleBounds=new THREE.Box3;d.visibleNodes=[];d.visibleGeometry=[];d.generateDEM=!1;d.profileRequests=[];d.name='';d.tempVector3=new THREE.Vector3;a=[d.pcoGeometry.tightBoundingBox,d.getBoundingBoxWorld()].find(function(a){return void 0!==a});d.updateMatrixWorld(!0);a=Z.computeTransformedBoundingBox(a,d.matrixWorld);
var b=a.max.z;d.material.heightMin=a.min.z;d.material.heightMax=b;d.projection=c.projection;d.root=d.pcoGeometry.root;return d};$jscomp.inherits(B,Y);B.prototype.setName=function(c){this.name!==c&&(this.name=c,this.dispatchEvent({type:'name_changed',name:c,pointcloud:this}))};B.prototype.getName=function(){return this.name};B.prototype.toTreeNode=function(c,a){var d=this,b=new Q,f=new THREE.Points(c.geometry,this.material);f.name=c.name;f.position.copy(c.boundingBox.min);f.frustumCulled=!0;f.onBeforeRender=
function(a,f,e,l,x,g){x.program&&(a.getContext().useProgram(x.program.program),x.program.getUniforms().map.level&&(f=c.getLevel(),x.uniforms.level.value=f,x.program.getUniforms().map.level.setValue(a.getContext(),f)),d.visibleNodeTextureOffsets&&x.program.getUniforms().map.vnStart&&(f=d.visibleNodeTextureOffsets.get(b),x.uniforms.vnStart.value=f,x.program.getUniforms().map.vnStart.setValue(a.getContext(),f)),x.program.getUniforms().map.pcIndex&&(f=b.pcIndex?b.pcIndex:d.visibleNodes.indexOf(b),x.uniforms.pcIndex.value=
f,x.program.getUniforms().map.pcIndex.setValue(a.getContext(),f)))};b.geometryNode=c;b.sceneNode=f;b.pointcloud=this;b.children={};for(var e in c.children)b.children[e]=c.children[e];a?(e=parseInt(c.name[c.name.length-1]),a.sceneNode.add(f),a.children[e]=b):(this.root=b,this.add(f));c.oneTimeDisposeHandlers.push(function(){var d=parseInt(c.name[c.name.length-1]);a.sceneNode.remove(b.sceneNode);a.children[d]=c});return b};B.prototype.updateVisibleBounds=function(){for(var c=[],a=0;a<this.visibleNodes.length;a++){for(var d=
this.visibleNodes[a],b=!0,f=0;f<d.children.length;f++){var e=d.children[f];e instanceof Q?b=b&&!e.sceneNode.visible:e instanceof E&&(b=!0)}b&&c.push(d)}this.visibleBounds.min=new THREE.Vector3(Infinity,Infinity,Infinity);this.visibleBounds.max=new THREE.Vector3(-Infinity,-Infinity,-Infinity);for(a=0;a<c.length;a++)d=c[a],this.visibleBounds.expandByPoint(d.getBoundingBox().min),this.visibleBounds.expandByPoint(d.getBoundingBox().max)};B.prototype.updateMaterial=function(c,a,d,b){c.fov=Math.PI/180*
d.fov;c.screenWidth=b.domElement.clientWidth;c.screenHeight=b.domElement.clientHeight;c.spacing=this.pcoGeometry.spacing*Math.max(this.scale.x,this.scale.y,this.scale.z);c.near=d.near;c.far=d.far;c.uniforms.octreeSize.value=this.pcoGeometry.boundingBox.getSize(new THREE.Vector3).x};B.prototype.computeVisibilityTextureData=function(c,a){p.measureTimings&&performance.mark('computeVisibilityTextureData-start');var d=new Uint8Array(4*c.length),b=new Map;c=c.slice();c.sort(function(a,c){a=a.geometryNode.name;
c=c.geometryNode.name;return a.length!==c.length?a.length-c.length:a<c?-1:a>c?1:0});for(var f=new THREE.Vector3,e=function(a,c){f.subVectors(c.center,a.origin);a=f.dot(a.direction);var d=f.dot(f)-a*a;c=c.radius*c.radius;if(d>c)return null;c=a+Math.sqrt(c-d);return 0>c?null:c},k=new Map,u=new Map,r=0;r<c.length;r++){var q=c[r];b.set(q,r);for(var n=[],g=0;8>g;g++){var h=q.children[g];h&&h.constructor===Q&&c.includes(h,r)&&n.push(h)}d[4*r]=0;d[4*r+1]=0;d[4*r+2]=0;d[4*r+3]=q.getLevel();for(g=0;g<n.length;g++){h=
n[g];var m=parseInt(h.geometryNode.name.substr(-1));d[4*r]+=Math.pow(2,m);0===g&&(h=c.indexOf(h,r),d[4*r+1]=h-r>>8,d[4*r+2]=(h-r)%256)}g=q.getBoundingBox().clone().getBoundingSphere(new THREE.Sphere);g.applyMatrix4(q.sceneNode.matrixWorld);g.applyMatrix4(a.matrixWorldInverse);n=new THREE.Ray(a.position,a.getWorldDirection(this.tempVector3));n=e(n,g);g=g.center.distanceTo(a.position)+g.radius;null===n&&(n=g);n=Math.max(n,g);k.has(q.getLevel())?(g=k.get(q.getLevel()),g=Math.max(g,n),k.set(q.getLevel(),
g)):k.set(q.getLevel(),n);q.geometryNode.hasChildren||(g={distance:n,i:r},u.set(q,g))}c=$jscomp.makeIterator(u);for(r=c.next();!r.done;r=c.next())if(r=$jscomp.makeIterator(r.value),q=r.next().value,g=r.next().value,q=q.getLevel(),n=g.distance,r=g.i,!(4>q))for(q=$jscomp.makeIterator(k),a=q.next();!a.done;a=q.next())e=$jscomp.makeIterator(a.value),a=e.next().value,e=e.next().value,n<1.2*e&&(d[4*r+3]=a);p.measureTimings&&(performance.mark('computeVisibilityTextureData-end'),performance.measure('render.computeVisibilityTextureData',
'computeVisibilityTextureData-start','computeVisibilityTextureData-end'));return{data:d,offsets:b}};B.prototype.nodeIntersectsProfile=function(c,a){c=c.boundingBox.clone().applyMatrix4(this.matrixWorld).getBoundingSphere(new THREE.Sphere);for(var d=!1,b=0;b<a.points.length-1;b++){var f=new THREE.Vector3(a.points[b+0].x,a.points[b+0].y,c.center.z),e=new THREE.Vector3(a.points[b+1].x,a.points[b+1].y,c.center.z);f=(new THREE.Line3(f,e)).closestPointToPoint(c.center,!0).distanceTo(c.center);d=d||f<c.radius+
a.width}return d};B.prototype.nodesOnRay=function(c,a){var d=[];a=a.clone();for(var b=0;b<c.length;b++){var f=c[b],e=f.getBoundingSphere(new THREE.Sphere).clone().applyMatrix4(this.matrixWorld);a.intersectsSphere(e)&&d.push(f)}return d};B.prototype.updateMatrixWorld=function(c){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===c)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=
!1};B.prototype.hideDescendants=function(c){for(var a=[],d=0;d<c.children.length;d++){var b=c.children[d];b.visible&&a.push(b)}for(;0<a.length;)for(c=a.shift(),c.visible=!1,d=0;d<c.children.length;d++)b=c.children[d],b.visible&&a.push(b)};B.prototype.moveToOrigin=function(){this.position.set(0,0,0);this.updateMatrixWorld(!0);var c=Z.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld);this.position.set(0,0,0).sub(c.getCenter(new THREE.Vector3))};B.prototype.moveToGroundPlane=function(){this.updateMatrixWorld(!0);
var c=Z.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld);this.position.y+=-c.min.y};B.prototype.getBoundingBoxWorld=function(){this.updateMatrixWorld(!0);return Z.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld)};B.prototype.getPointsInProfile=function(c,a,d){d={segments:[],boundingBox:new THREE.Box3,projectedBoundingBox:new THREE.Box2};for(var b=0;b<c.points.length-1;b++){var f=c.points[b],e=c.points[b+1],k=this.getProfile(f,e,c.width,a),u={start:f,end:e,points:k,
project:null};d.segments.push(u);d.boundingBox.expandByPoint(k.boundingBox.min);d.boundingBox.expandByPoint(k.boundingBox.max)}c=new THREE.Vector3;for(b=0;b<d.segments.length;b++)u=d.segments[b],f=u.start,e=u.end,a=function(a,c,d,b){var f=new THREE.Vector3(1,0,0);c=(new THREE.Vector3).subVectors(c,a);c.y=0;c.normalize();var e=Math.acos(f.dot(c));0<c.z&&(e=-e);return function(c){var f=(new THREE.Matrix4).makeTranslation(-a.x,-b.min.y,-a.z),l=(new THREE.Matrix4).makeRotationY(-e),k=(new THREE.Matrix4).makeTranslation(d.x,
0,0);c=c.clone();c.applyMatrix4(f);c.applyMatrix4(l);c.applyMatrix4(k);return c}}(f,e,c.clone(),d.boundingBox.clone()),u.project=a,c.x+=(new THREE.Vector3(f.x,0,f.z)).distanceTo(new THREE.Vector3(e.x,0,e.z)),c.y+=e.y-f.y;d.projectedBoundingBox.min.x=0;d.projectedBoundingBox.min.y=d.boundingBox.min.y;d.projectedBoundingBox.max.x=c.x;d.projectedBoundingBox.max.y=d.boundingBox.max.y;return d};B.prototype.getProfile=function(c,a,d,b,f){};B.prototype.getVisibleExtent=function(){return this.visibleBounds.applyMatrix4(this.matrixWorld)};
B.prototype.pick=function(c,a,d,b){b=void 0===b?{}:b;var f=c.renderer,e=c.pRenderer;performance.mark('pick-start');var k=function(a,c){return void 0!==a?a:c};c=k(b.pickWindowSize,17);k(b.pickOutsideClipRegion,!1);var l=f.getSize(new THREE.Vector3),g=Math.ceil(k(b.width,l.width));l=Math.ceil(k(b.height,l.height));var q=k(b.pointSizeType,this.material.pointSizeType);k=k(b.pointSize,this.material.size);d=this.nodesOnRay(this.visibleNodes,d);if(0===d.length)return null;if(!this.pickState){var n=new THREE.Scene,
h=new F;h.pointColorType=H.POINT_INDEX;this.pickState={renderTarget:new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),material:h,scene:n}}n=this.pickState;h=n.material;h.pointSizeType=q;h.shape=this.material.shape;h.size=k;h.uniforms.minSize.value=this.material.uniforms.minSize.value;h.uniforms.maxSize.value=this.material.uniforms.maxSize.value;h.classification=this.material.classification;b.pickClipped?(h.clipBoxes=this.material.clipBoxes,
h.clipTask=this.material.clipTask===ka.HIGHLIGHT?ka.NONE:this.material.clipTask):h.clipBoxes=[];this.updateMaterial(h,d,a,f);n.renderTarget.setSize(g,l);k=new THREE.Vector2(b.x,b.y);q=f.getContext();q.enable(q.SCISSOR_TEST);q.scissor(parseInt(k.x-(c-1)/2),parseInt(k.y-(c-1)/2),parseInt(c),parseInt(c));f.state.buffers.depth.setTest(h.depthTest);f.state.buffers.depth.setMask(h.depthWrite);f.state.setBlending(THREE.NoBlending);f.setRenderTarget(n.renderTarget);q.clearColor(0,0,0,0);f.clearTarget(n.renderTarget,
!0,!0,!0);var m=this.material;this.material=h;e.renderOctree(this,d,a,n.renderTarget);this.material=m;a=parseInt(Math.min(Math.max(0,k.x-(c-1)/2),g));e=parseInt(Math.min(Math.max(0,k.y-(c-1)/2),l));g=parseInt(Math.min(a+c,g)-a);l=parseInt(Math.min(e+c,l)-e);l=new Uint8Array(4*g*l);q.readPixels(a,e,c,c,q.RGBA,q.UNSIGNED_BYTE,l);f.setRenderTarget(null);f.resetGLState();f.setScissorTest(!1);q.disable(q.SCISSOR_TEST);a=new Uint32Array(l.buffer);f=[];for(e=0;e<c;e++)for(q=0;q<c;q++)n=e+q*c,k=Math.pow(e-
(c-1)/2,2)+Math.pow(q-(c-1)/2,2),g=l[4*n+3],l[4*n+3]=0,n=a[n],0===g&&0===n||void 0===g||void 0===n||(g={pIndex:n,pcIndex:g,distanceToCenter:k},b.all?f.push(g):0<f.length?k<f[0].distanceToCenter&&(f[0]=g):f.push(g));c=$jscomp.makeIterator(f);for(g=c.next();!g.done;g=c.next()){g=g.value;l={};if(!d[g.pcIndex])return null;a=d[g.pcIndex];q=a.sceneNode;k=a.geometryNode.geometry;for(var G in k.attributes)n=k.attributes[G],'position'===G&&(a=n.array[3*g.pIndex],e=n.array[3*g.pIndex+1],a=new THREE.Vector3(a,
e,n.array[3*g.pIndex+2]),a.applyMatrix4(q.matrixWorld),l[G]=a);g.point=l}performance.mark('pick-end');performance.measure('pick','pick-start','pick-end');return b.all?f.map(function(a){return a.point}):0===f.length?null:f[0].point};B.prototype.getFittedBoxGen=function d(a){var b,f,e=this,k,g,h,q,n,m,t,G,p,v,z,y,w,B,A,D;return $jscomp.generator.createGenerator(d,function(d){1==d.nextAddress&&(b=new THREE.Box3,f=(new THREE.Matrix4).getInverse(a.matrixWorld),k=$jscomp.makeIterator(e.visibleNodes),g=
k.next());if(3!=d.nextAddress){if(g.done)return B=b.getCenter(new THREE.Vector3).applyMatrix4(a.matrixWorld),A=new THREE.Object3D,A.position.copy(B),A.scale.copy(a.scale),A.rotation.copy(a.rotation),D=(new THREE.Vector3).subVectors(b.max,b.min),A.scale.multiply(D),d.yield(A,0);h=g.value;if(!h.sceneNode)return d.jumpTo(3);q=h.geometryNode.buffer;n=q.offset('position');m=q.stride;t=new DataView(q.data);G=(new THREE.Matrix4).multiplyMatrices(f,h.sceneNode.matrixWorld);p=new THREE.Vector4;for(v=0;v<q.numElements;v++)z=
t.getFloat32(v*m+n+0,!0),y=t.getFloat32(v*m+n+4,!0),w=t.getFloat32(v*m+n+8,!0),p.set(z,y,w,1),p.applyMatrix4(G),-.5<p.x&&.5>p.x&&-.5<p.y&&.5>p.y&&-.5<p.z&&.5>p.z&&b.expandByPoint(p);return d.yield(void 0,3)}g=k.next();return d.jumpTo(2)})};B.prototype.getFittedBox=function(a,b){b=void 0===b?Infinity:b;for(var d=new THREE.Box3,f=(new THREE.Matrix4).getInverse(a.matrixWorld),e=$jscomp.makeIterator(this.visibleNodes),k=e.next();!k.done;k=e.next()){var g=k.value;if(g.sceneNode&&!(g.getLevel()>b)){k=g.geometryNode.buffer;
var h=k.offset('position'),q=k.stride,n=new DataView(k.data);g=(new THREE.Matrix4).multiplyMatrices(f,g.sceneNode.matrixWorld);for(var m=new THREE.Vector4,t=0;t<k.numElements;t++){var G=n.getFloat32(t*q+h+0,!0),p=n.getFloat32(t*q+h+4,!0),v=n.getFloat32(t*q+h+8,!0);m.set(G,p,v,1);m.applyMatrix4(g);-.5<m.x&&.5>m.x&&-.5<m.y&&.5>m.y&&-.5<m.z&&.5>m.z&&d.expandByPoint(m)}}}f=d.getCenter(new THREE.Vector3).applyMatrix4(a.matrixWorld);b=new THREE.Object3D;b.position.copy(f);b.scale.copy(a.scale);b.rotation.copy(a.rotation);
a=(new THREE.Vector3).subVectors(d.max,d.min);b.scale.multiply(a);return b};B.prototype.find=function(a){var b=null;a=$jscomp.makeIterator(a);for(var e=a.next();!e.done;e=a.next())e=e.value,b='r'===e?this.root:b.children[e];return b};$jscomp.global.Object.defineProperties(B.prototype,{progress:{configurable:!0,enumerable:!0,get:function(){return this.visibleNodes.length/this.visibleGeometry.length}}});var R=function(){this.needsTransformUpdate=!0;this.kdtree=this.sceneNode=this.right=this.left=null;
return this};$jscomp.inherits(R,J);R.prototype.getNumPoints=function(){return this.geometryNode.numPoints};R.prototype.isLoaded=function(){return!0};R.prototype.isTreeNode=function(){return!0};R.prototype.isGeometryNode=function(){return!1};R.prototype.getLevel=function(){return this.geometryNode.level};R.prototype.getBoundingSphere=function(){return this.geometryNode.boundingSphere};R.prototype.getBoundingBox=function(){return this.geometryNode.boundingBox};R.prototype.toTreeNode=function(a){var b=
null;this.left===a?b=this.left:this.right===a&&(b=this.right);if(b.loaded){a=new R;var e=THREE.PointCloud(b.geometry,this.kdtree.material);e.visible=!1;a.kdtree=this.kdtree;a.geometryNode=b;a.sceneNode=e;a.parent=this;a.left=this.geometryNode.left;a.right=this.geometryNode.right}};R.prototype.getChildren=function(){var a=[];this.left&&a.push(this.left);this.right&&a.push(this.right);return a};var M=function(a){var b=Y.call(this)||this;b.root=null;a.root?b.root=a.root:a.addEventListener('hierarchy_loaded',
function(){b.root=a.root});b.visiblePointsTarget=2E6;b.minimumNodePixelSize=150;b.position.sub(a.offset);b.updateMatrix();b.numVisibleNodes=0;b.numVisiblePoints=0;b.boundingBoxNodes=[];b.loadQueue=[];b.visibleNodes=[];b.pcoGeometry=a;b.boundingBox=b.pcoGeometry.boundingBox;b.boundingSphere=b.pcoGeometry.boundingSphere;b.material=new F({vertexColors:THREE.VertexColors,size:.05,treeType:na.KDTREE});b.material.sizeType=fa.ATTENUATED;b.material.size=.05;b.profileRequests=[];b.name='';return b};$jscomp.inherits(M,
Y);M.prototype.getBoundingBoxWorld=function(){this.updateMatrixWorld(!0);return Z.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld)};M.prototype.setName=function(a){this.name!==a&&(this.name=a,this.dispatchEvent({type:'name_changed',name:a,pointcloud:this}))};M.prototype.getName=function(){return this.name};M.prototype.getLevel=function(){return this.level};M.prototype.toTreeNode=function(a,b){var d=this,f=new R,e=new THREE.Points(a.geometry,this.material);e.frustumCulled=!0;e.onBeforeRender=
function(b,e,l,x,g,h){g.program&&(b.getContext().useProgram(g.program.program),g.program.getUniforms().map.level&&(e=a.getLevel(),g.uniforms.level.value=e,g.program.getUniforms().map.level.setValue(b.getContext(),e)),d.visibleNodeTextureOffsets&&g.program.getUniforms().map.vnStart&&(e=d.visibleNodeTextureOffsets.get(f),g.uniforms.vnStart.value=e,g.program.getUniforms().map.vnStart.setValue(b.getContext(),e)),g.program.getUniforms().map.pcIndex&&(e=f.pcIndex?f.pcIndex:d.visibleNodes.indexOf(f),g.uniforms.pcIndex.value=
e,g.program.getUniforms().map.pcIndex.setValue(b.getContext(),e)))};f.geometryNode=a;f.sceneNode=e;f.pointcloud=this;f.left=a.left;f.right=a.right;b?(b.sceneNode.add(e),b.left===a?b.left=f:b.right===a&&(b.right=f)):(this.root=f,this.add(e));a.oneTimeDisposeHandlers.push(function(){b.sceneNode.remove(f.sceneNode);b.left===f?b.left=a:b.right===f&&(b.right=a)});return f};M.prototype.updateMaterial=function(a,b,e,f){a.fov=Math.PI/180*e.fov;a.screenWidth=f.domElement.clientWidth;a.screenHeight=f.domElement.clientHeight;
a.spacing=this.pcoGeometry.spacing;a.near=e.near;a.far=e.far;this.maxLevel>a.levels&&(a.levels=this.maxLevel+2);b=this.boundingBox.getSize(new THREE.Vector3);a.bbSize=[b.x,b.y,b.z]};M.prototype.updateVisibleBounds=function(){};M.prototype.hideDescendants=function(a){for(var b=[],e=0;e<a.children.length;e++){var f=a.children[e];f.visible&&b.push(f)}for(;0<b.length;)for(f=b.shift(),f.visible=!1,f.boundingBoxNode&&(f.boundingBoxNode.visible=!1),e=0;e<f.children.length;e++)a=f.children[e],a.visible&&
b.push(a)};M.prototype.updateMatrixWorld=function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1};M.prototype.nodesOnRay=function(a,b){var d=[];b=b.clone();for(var e=0;e<a.length;e++){var g=a[e],k=g.getBoundingSphere(new THREE.Sphere).clone().applyMatrix4(g.sceneNode.matrixWorld);b.intersectsSphere(k)&&
d.push(g)}return d};M.prototype.pick=function(a,b,e,f){f=void 0===f?{}:f;var d=a.renderer,k=a.pRenderer;performance.mark('pick-start');var l=function(a,b){return void 0!==a?a:b};a=l(f.pickWindowSize,17);l(f.pickOutsideClipRegion,!1);var g=d.getSize(new THREE.Vector3),h=Math.ceil(l(f.width,g.width));g=Math.ceil(l(f.height,g.height));var n=l(f.pointSizeType,this.material.pointSizeType);l=l(f.pointSize,this.material.size);e=this.nodesOnRay(this.visibleNodes,e);if(0===e.length)return null;if(!this.pickState){var m=
new THREE.Scene,t=new F;t.pointColorType=H.POINT_INDEX;this.pickState={renderTarget:new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),material:t,scene:m}}m=this.pickState;t=m.material;t.pointSizeType=n;t.shape=this.material.shape;t.size=l;t.uniforms.minSize.value=this.material.uniforms.minSize.value;t.uniforms.maxSize.value=this.material.uniforms.maxSize.value;t.classification=this.material.classification;f.pickClipped?(t.clipBoxes=
this.material.clipBoxes,t.clipTask=this.material.clipTask===ka.HIGHLIGHT?ka.NONE:this.material.clipTask):t.clipBoxes=[];this.updateMaterial(t,e,b,d);m.renderTarget.setSize(h,g);l=new THREE.Vector2(f.x,f.y);n=d.getContext();n.enable(n.SCISSOR_TEST);n.scissor(parseInt(l.x-(a-1)/2),parseInt(l.y-(a-1)/2),parseInt(a),parseInt(a));d.state.buffers.depth.setTest(t.depthTest);d.state.buffers.depth.setMask(t.depthWrite);d.state.setBlending(THREE.NoBlending);d.clearTarget(m.renderTarget,!0,!0,!0);d.setRenderTarget(m.renderTarget);
n.clearColor(0,0,0,0);d.clearTarget(m.renderTarget,!0,!0,!0);var G=this.material;this.material=t;k.renderOctree(this,e,b,m.renderTarget);this.material=G;b=parseInt(Math.min(Math.max(0,l.x-(a-1)/2),h));k=parseInt(Math.min(Math.max(0,l.y-(a-1)/2),g));h=parseInt(Math.min(b+a,h)-b);g=parseInt(Math.min(k+a,g)-k);g=new Uint8Array(4*h*g);n.readPixels(b,k,a,a,n.RGBA,n.UNSIGNED_BYTE,g);d.setRenderTarget(null);d.resetGLState();d.setScissorTest(!1);n.disable(n.SCISSOR_TEST);b=new Uint32Array(g.buffer);d=[];
for(k=0;k<a;k++)for(n=0;n<a;n++)m=k+n*a,l=Math.pow(k-(a-1)/2,2)+Math.pow(n-(a-1)/2,2),h=g[4*m+3],g[4*m+3]=0,m=b[m],0===h&&0===m||void 0===h||void 0===m||(h={pIndex:m,pcIndex:h,distanceToCenter:l},f.all?d.push(h):0<d.length?l<d[0].distanceToCenter&&(d[0]=h):d.push(h));a=$jscomp.makeIterator(d);for(h=a.next();!h.done;h=a.next()){h=h.value;g={};if(!e[h.pcIndex])return null;b=e[h.pcIndex];n=b.sceneNode;l=b.geometryNode.geometry;for(var p in l.attributes)m=l.attributes[p],'position'===p&&(b=m.array[3*
h.pIndex],k=m.array[3*h.pIndex+1],b=new THREE.Vector3(b,k,m.array[3*h.pIndex+2]),b.applyMatrix4(n.matrixWorld),g[p]=b);h.point=g}performance.mark('pick-end');performance.measure('pick','pick-start','pick-end');return f.all?d.map(function(a){return a.point}):0===d.length?null:d[0].point};M.prototype.computeVisibilityTextureData=function(a){p.measureTimings&&performance.mark('computeVisibilityTextureData-start');var b=new Uint8Array(3*a.length),e=new Map;a=a.slice();a.sort(function(a,b){var d=a.geometryNode.level,
e=b.geometryNode.level;a=a.geometryNode.number;b=b.geometryNode.number;return d!==e?d-e:a<b?-1:a>b?1:0});for(var f=[],g=0;g<a.length;g++)f.push(a[g].geometryNode.number);for(g=0;g<a.length;g++){var k=a[g];e.set(k,g);var h=0,r=0,q=0;k.geometryNode.left&&0<f.indexOf(k.geometryNode.left.number)&&(h+=1,r=f.indexOf(k.geometryNode.left.number)-g);k.geometryNode.right&&0<f.indexOf(k.geometryNode.right.number)&&(h+=2,r=0===r?f.indexOf(k.geometryNode.right.number)-g:r);'X'===k.geometryNode.split?q=1:'Y'===
k.geometryNode.split?q=2:'Z'===k.geometryNode.split&&(q=4);b[3*g]=h;b[3*g+1]=r;b[3*g+2]=q}p.measureTimings&&(performance.mark('computeVisibilityTextureData-end'),performance.measure('render.computeVisibilityTextureData','computeVisibilityTextureData-start','computeVisibilityTextureData-end'));return{data:b,offsets:e}};$jscomp.global.Object.defineProperties(M.prototype,{progress:{configurable:!0,enumerable:!0,get:function(){return this.pcoGeometry.root?0<p.numNodesLoading?0:1:0}}});var V=function(){this.pcoGeometry=
this.number=this.boundingBox=this.right=this.left=null;this.loaded=!1;this.level=this.numPoints=0;this.children=[];this.oneTimeDisposeHandlers=[]};V.prototype.isGeometryNode=function(){return!0};V.prototype.isTreeNode=function(){return!1};V.prototype.isLoaded=function(){return this.loaded};V.prototype.getBoundingSphere=function(){return this.boundingSphere};V.prototype.getBoundingBox=function(){return this.boundingBox};V.prototype.getChildren=function(){var a=[];this.left&&a.push(this.left);this.right&&
a.push(this.right);return a};V.prototype.getLevel=function(){return this.level};V.prototype.load=function(){if(!(this.loaded||this.loading||p.numNodesLoading>=p.maxNodesLoading)){this.loading=!0;p.numNodesLoading++;var a=this,b=this.pcoGeometry.url+'?node='+this.number,e=new XMLHttpRequest;e.overrideMimeType('text/plain');e.open('GET',b,!0);e.responseType='arraybuffer';e.onload=function(){try{var b=e.response,d=new DataView(b),k=b.byteLength/17,l=new ArrayBuffer(28*k);new DataView(l);var g=new Float32Array(3*
k),h=new Uint8Array(4*k),n=new Float32Array(k),m=new Uint8Array(k),t=new ArrayBuffer(4*k),G=new Uint32Array(t),v=new THREE.Box3;for(b=0;b<k;b++){var y=d.getFloat32(17*b,!0)+a.boundingBox.min.x,z=d.getFloat32(17*b+4,!0)+a.boundingBox.min.y,w=d.getFloat32(17*b+8,!0)+a.boundingBox.min.z,A=d.getUint8(17*b+12,!0),B=d.getUint8(17*b+13,!0),D=d.getUint8(17*b+14,!0),E=d.getUint8(17*b+15,!0),F=d.getUint8(17*b+16,!0);v.expandByPoint(new THREE.Vector3(y,z,w));g[3*b]=y;g[3*b+1]=z;g[3*b+2]=w;h[4*b]=A;h[4*b+1]=
B;h[4*b+2]=D;h[4*b+3]=255;n[b]=E;m[b]=F;G[b]=b}var C=new THREE.BufferGeometry;C.setAttribute('position',new THREE.BufferAttribute(g,3));C.setAttribute('color',new THREE.BufferAttribute(h,4,!0));C.setAttribute('intensity',new THREE.BufferAttribute(n,1));C.setAttribute('classification',new THREE.BufferAttribute(m,1));var H=new THREE.BufferAttribute(new Uint8Array(t),4,!0);C.setAttribute('indices',H);a.geometry=C;a.numPoints=k;a.loaded=!0;a.loading=!1;p.numNodesLoading--}catch(Na){console.error('Potree: Exception thrown parsing points.',
Na),p.numNodesLoading--}};e.onerror=function(){p.numNodesLoading--;console.log('Potree: Failed to load file, '+e.status+', file: '+b)};e.send(null)}};V.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();this.oneTimeDisposeHandlers=[]}};V.prototype.getNumPoints=function(){return this.numPoints};var ha=function(){var a=THREE.EventDispatcher.call(this)||
this;a.numPoints=0;a.version=0;a.boundingBox=null;a.numNodes=0;a.name=null;a.provider=null;a.url=null;a.root=null;a.levels=0;a._spacing=null;a.pointAttributes=new g(['POSITION_CARTESIAN','COLOR_PACKED']);return a};$jscomp.inherits(ha,THREE.EventDispatcher);ha.load=function(a,b){var d=new XMLHttpRequest;d.overrideMimeType('text/plain');d.open('GET',a+'?info',!0);d.onreadystatechange=function(){try{if(4===d.readyState&&200===d.status){var e=JSON.parse(d.responseText),l=new ha;l.url=a;l.name=e.Name;
l.provider=e.Provider;l.numNodes=e.Nodes;l.numPoints=e.Points;l.version=e.Version;l.boundingBox=new THREE.Box3((new THREE.Vector3).fromArray(e.BoundingBox.slice(0,3)),(new THREE.Vector3).fromArray(e.BoundingBox.slice(3,6)));e.Spacing&&(l.spacing=e.Spacing);var k=l.boundingBox.min.clone().multiplyScalar(-1);l.boundingBox.min.add(k);l.boundingBox.max.add(k);l.offset=k;var g=new THREE.Vector3;l.boundingBox.getCenter(g);var h=l.boundingBox.getSize(new THREE.Vector3).length()/2;l.boundingSphere=new THREE.Sphere(g,
h);l.loadHierarchy();b(l)}else 4===d.readyState&&b(null)}catch(q){console.error(q.message),b(null)}};d.send(null)};ha.prototype.loadHierarchy=function(){var a=this,b=this.url+'?tree',e=new XMLHttpRequest;e.overrideMimeType('text/plain');e.open('GET',b,!0);e.responseType='arraybuffer';e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var b=e.response,d=b.byteLength/3;b=new DataView(b);for(var k=[],l=null,g=0,h=0;h<d;h++){var n=b.getUint8(3*h,!0),m=0<(n&1),t=0<(n&2),G=0<(n&8),p=0<
(n&16),v=null;0<(n&4)?v='X':G&&(v='Y');p&&(v='Z');n=new V;n.hasLeft=m;n.hasRight=t;n.split=v;n.isLeaf=!m&&!t;n.number=h;n.left=null;n.right=null;n.pcoGeometry=a;n.level=k.length;g=Math.max(g,n.level);0<k.length?(m=k[k.length-1],n.boundingBox=m.boundingBox.clone(),t=m.boundingBox.getSize(new THREE.Vector3),m.hasLeft&&!m.left?(m.left=n,m.children.push(n),'X'===m.split?n.boundingBox.max.x=n.boundingBox.min.x+t.x/2:'Y'===m.split?n.boundingBox.max.y=n.boundingBox.min.y+t.y/2:'Z'===m.split&&(n.boundingBox.max.z=
n.boundingBox.min.z+t.z/2),m=new THREE.Vector3,n.boundingBox.getCenter(m),t=n.boundingBox.getSize(new THREE.Vector3).length()/2):(m.right=n,m.children.push(n),'X'===m.split?n.boundingBox.min.x+=t.x/2:'Y'===m.split?n.boundingBox.min.y+=t.y/2:'Z'===m.split&&(n.boundingBox.min.z+=t.z/2),m=new THREE.Vector3,n.boundingBox.getCenter(m),t=n.boundingBox.getSize(new THREE.Vector3).length()/2),n.boundingSphere=new THREE.Sphere(m,t)):(l=n,l.boundingBox=a.boundingBox.clone(),m=new THREE.Vector3,l.boundingBox.getCenter(m),
t=l.boundingBox.getSize(new THREE.Vector3).length()/2,l.boundingSphere=new THREE.Sphere(m,t));m=n.boundingBox.getSize(new THREE.Vector3);n.spacing=(m.x+m.y+m.z)/3/75;n.estimatedSpacing=n.spacing;k.push(n);if(n.isLeaf)for(n=!1;!n&&0<k.length;)k.pop(),n=k[k.length-1],n=0<k.length&&n.hasRight&&null==n.right}a.root=l;a.levels=g;a.dispatchEvent({type:'hierarchy_loaded'})}};e.send(null)};$jscomp.global.Object.defineProperties(ha.prototype,{spacing:{configurable:!0,enumerable:!0,get:function(){if(this._spacing)return this._spacing;
if(this.root)return this.root.spacing},set:function(a){this._spacing=a}}});qa.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.sinkDown(0));return a},remove:function(a){for(var b=this.content.length,e=0;e<b;e++)if(this.content[e]==a){a=this.content.pop();if(e==b-1)break;this.content[e]=a;this.bubbleUp(e);this.sinkDown(e);break}},size:function(){return this.content.length},
bubbleUp:function(a){for(var b=this.content[a],e=this.scoreFunction(b);0<a;){var f=Math.floor((a+1)/2)-1,g=this.content[f];if(e>=this.scoreFunction(g))break;this.content[f]=b;this.content[a]=g;a=f}},sinkDown:function(a){for(var b=this.content.length,e=this.content[a],f=this.scoreFunction(e);;){var g=2*(a+1),k=g-1,h=null;if(k<b){var m=this.scoreFunction(this.content[k]);m<f&&(h=k)}g<b&&this.scoreFunction(this.content[g])<(null==h?f:m)&&(h=g);if(null==h)break;this.content[a]=this.content[h];this.content[h]=
e;a=h}}};var pa={position:0,color:1,intensity:2,classification:3,returnNumber:4,numberOfReturns:5,pointSourceID:6,indices:7,normal:8,spacing:9},Ia={DEFAULT:{0:new THREE.Vector4(.5,.5,.5,1),1:new THREE.Vector4(.5,.5,.5,1),2:new THREE.Vector4(.63,.32,.18,1),3:new THREE.Vector4(0,1,0,1),4:new THREE.Vector4(0,.8,0,1),5:new THREE.Vector4(0,.6,0,1),6:new THREE.Vector4(1,.66,0,1),7:new THREE.Vector4(1,0,1,1),8:new THREE.Vector4(1,0,0,1),9:new THREE.Vector4(0,0,1,1),12:new THREE.Vector4(1,1,0,1),DEFAULT:new THREE.Vector4(.3,
.6,.6,.5)}},ka={NONE:0,HIGHLIGHT:1,SHOW_INSIDE:2,SHOW_OUTSIDE:3},fa={FIXED:0,ATTENUATED:1,ADAPTIVE:2},oa={SQUARE:0,CIRCLE:1,PARABOLOID:2},H={RGB:0,COLOR:1,DEPTH:2,HEIGHT:3,ELEVATION:3,INTENSITY:4,INTENSITY_GRADIENT:5,LOD:6,LEVEL_OF_DETAIL:6,POINT_INDEX:7,CLASSIFICATION:8,RETURN_NUMBER:9,SOURCE:10,NORMAL:11,PHONG:12,RGB_HEIGHT:13,COMPOSITE:50},na={OCTREE:0,KDTREE:1};J=function(){this.boundingBox=new THREE.Box3;this.numPoints=0;this.data={}};J.prototype.add=function(a){var b=this.numPoints,e=b+a.numPoints,
f=Object.keys(this.data),g=Object.keys(a.data),k=new Set([].concat($jscomp.arrayFromIterable(f),$jscomp.arrayFromIterable(g)));k=$jscomp.makeIterator(k);for(var h=k.next();!h.done;h=k.next())if(h=h.value,f.includes(h)&&g.includes(h)){var m=this.data[h].constructor,q=new m(this.data[h].length+a.data[h].length);q.set(this.data[h],0);q.set(a.data[h],this.data[h].length);this.data[h]=q}else f.includes(h)&&!g.includes(h)?(q=this.data[h].length/this.numPoints,m=this.data[h].constructor,m=new m(q*e),m.set(this.data[h],
0),this.data[h]=m):!f.includes(h)&&g.includes(h)&&(q=a.data[h].length/a.numPoints,m=a.data[h].constructor,m=new m(q*e),m.set(a.data[h],q*b),this.data[h]=m);this.numPoints=e;this.boundingBox.union(a.boundingBox)};var va=function(a,b){this.gl=a;this.texture=b;this.id=a.createTexture();this.target=a.TEXTURE_2D;this.version=-1;this.update(b)};va.prototype.update=function(){if(this.texture.image){var a=this.gl,b=this.texture;if(this.version!==b.version){this.target=a.TEXTURE_2D;a.bindTexture(this.target,
this.id);var e=W(a,b.format),f=b.image.width,g=b.image.height,k=W(a,b.type);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);if(b instanceof THREE.DataTexture){var h=b.image.data;a.texParameteri(this.target,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(this.target,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,W(a,b.magFilter));a.texParameteri(this.target,
a.TEXTURE_MIN_FILTER,W(a,b.minFilter));a.texImage2D(this.target,0,e,f,g,0,e,k,h)}else b instanceof THREE.CanvasTexture&&(h=b.image,a.texParameteri(this.target,a.TEXTURE_WRAP_S,W(a,b.wrapS)),a.texParameteri(this.target,a.TEXTURE_WRAP_T,W(a,b.wrapT)),a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,W(a,b.magFilter)),a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,W(a,b.minFilter)),a.texImage2D(this.target,0,e,e,k,h));a.bindTexture(this.target,null);this.version=b.version}}else this.version=this.texture.version};
var S=function(a,b,e,f){this.gl=a;this.name=b;this.vsSource=e;this.fsSource=f;this.cache=new Map;this.program=this.fs=this.vs=null;this.uniformLocations={};this.attributeLocations={};this.update(e,f)};S.prototype.update=function(a,b){this.vsSource=a;this.fsSource=b;this.linkProgram()};S.prototype.compileShader=function(a,b){var d=this.gl;d.shaderSource(a,b);d.compileShader(a);if(!d.getShaderParameter(a,d.COMPILE_STATUS))throw a=d.getShaderInfoLog(a),Error('Potree: Could not compile shader '+this.name+
', '+a);};S.prototype.linkProgram=function(){var a=this.gl;this.uniformLocations={};this.attributeLocations={};a.useProgram(null);var b=this.cache.get(this.vsSource+', '+this.fsSource);if(b)this.program=b.program,this.vs=b.vs,this.fs=b.fs,this.attributeLocations=b.attributeLocations,this.uniformLocations=b.uniformLocations;else{this.vs=a.createShader(a.VERTEX_SHADER);this.fs=a.createShader(a.FRAGMENT_SHADER);this.program=a.createProgram();var e=$jscomp.makeIterator(Object.keys(pa));for(b=e.next();!b.done;b=
e.next()){var f=b.value;b=pa[f];a.bindAttribLocation(this.program,b,f)}this.compileShader(this.vs,this.vsSource);this.compileShader(this.fs,this.fsSource);e=this.program;a.attachShader(e,this.vs);a.attachShader(e,this.fs);a.linkProgram(e);a.detachShader(e,this.vs);a.detachShader(e,this.fs);if(!a.getProgramParameter(e,a.LINK_STATUS))throw a=a.getProgramInfoLog(e),Error('Potree: Could not link program '+this.name+', '+a);var g=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES);for(f=0;f<g;f++){var k=a.getActiveAttrib(e,
f);b=a.getAttribLocation(e,k.name);this.attributeLocations[k.name]=b}g=a.getProgramParameter(e,a.ACTIVE_UNIFORMS);for(f=0;f<g;f++)k=a.getActiveUniform(e,f),b=a.getUniformLocation(e,k.name),this.uniformLocations[k.name]=b;b={program:this.program,vs:this.vs,fs:this.fs,attributeLocations:this.attributeLocations,uniformLocations:this.uniformLocations};this.cache.set(this.vsSource+', '+this.fsSource,b)}};S.prototype.setUniformMatrix4=function(a,b){var d=this.gl;a=this.uniformLocations[a];null!=a&&(b=new Float32Array(b.elements),
d.uniformMatrix4fv(a,!1,b))};S.prototype.setUniform1f=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1f(a,b)};S.prototype.setUniformBoolean=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)};S.prototype.setUniformTexture=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)};S.prototype.setUniform2f=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform2f(a,b[0],b[1])};S.prototype.setUniform3f=function(a,b){a=this.uniformLocations[a];
null!=a&&this.gl.uniform3f(a,b[0],b[1],b[2])};S.prototype.setUniform=function(a,b){b.constructor===THREE.Matrix4?this.setUniformMatrix4(a,b):'number'===typeof b?this.setUniform1f(a,b):'boolean'===typeof b?this.setUniformBoolean(a,b):b instanceof va?this.setUniformTexture(a,b):b instanceof Array?2===b.length?this.setUniform2f(a,b):3===b.length&&this.setUniform3f(a,b):console.error('Potree: Unhandled uniform type: ',a,b)};S.prototype.setUniform1i=function(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,
b)};var Ja=function(){this.numElements=0;this.vao=null;this.vbos=new Map},T=function(){var a=THREE.Mesh.call(this,new THREE.Geometry,new THREE.MeshBasicMaterial({opacity:0,wireframe:!1,alphaTest:1}))||this;a.frustumCulled=!0;a.pointclouds=[];a.nodeSize=30;a.pointBudget=1E10;a.nodeLoadRate=2;return a};$jscomp.inherits(T,THREE.Mesh);T.prototype.raycast=function(a,b){};T.prototype.setPointBudget=function(a){this.pointBudget=a};T.prototype.onBeforeRender=function(a,b,e,f,g,k){for(b=0;b<this.pointclouds.length;b++)this.pointclouds[b].minimumNodePixelSize=
this.nodeSize;ya(this.pointclouds,e,a)};T.prototype.recalculateBoxGeometry=function(){var a=this.getBoundingBox(),b=a.getSize(new THREE.Vector3),e=a.getCenter(new THREE.Vector3);a=new THREE.Matrix4;a.makeTranslation(e.x,e.y,e.z);b=new THREE.BoxBufferGeometry(b.x,b.y,b.z);b.applyMatrix(a);this.geometry=b};T.prototype.add=function(a){THREE.Object3D.prototype.add.call(this,a);a instanceof Y&&(a.showBoundingBox=!1,a.generateDEM=!1,this.pointclouds.push(a),this.recalculateBoxGeometry())};T.prototype.remove=
function(a){THREE.Object3D.prototype.remove.call(this,a);a instanceof Y&&(a=this.pointclouds.indexOf(a),-1!==a&&(this.pointclouds.splice(a,1),this.recalculateBoxGeometry()))};T.prototype.getBoundingBox=function(){var a=new THREE.Box3;this.updateMatrixWorld(!0);for(var b=0;b<this.pointclouds.length;b++){var e=this.pointclouds[b];e.updateMatrixWorld(!0);e=Z.computeTransformedBoundingBox(e.pcoGeometry.tightBoundingBox?e.pcoGeometry.tightBoundingBox:e.boundingBox,e.matrixWorld);a.union(e)}return a};T.prototype.estimateHeightAt=
function(a){for(var b=null,e=Infinity,f=$jscomp.makeIterator(this.pointclouds),g=f.next();!g.done;g=f.next())if(g=g.value,void 0!==g.root.geometryNode){var k=null,h=Infinity,m=a.clone().sub(g.position);m.z=0;m=new THREE.Ray(m,new THREE.Vector3(0,0,1));for(var q=[g.root];0<q.length;){var n=q.pop(),p=n.getBoundingBox();if(m.intersectBox(p)){p=n.geometryNode.mean.z+g.position.z+n.geometryNode.boundingBox.min.z;n.geometryNode.spacing<=h&&(k=p,h=n.geometryNode.spacing);p=$jscomp.makeIterator(Object.keys(n.children));
for(var t=p.next();!t.done;t=p.next())t=t.value,n.children[t].geometryNode&&q.push(n.children[t])}}if(null===b||h<e)b=k,e=h}return b};var U=function(){var a=T.call(this)||this;a.buffers=new Map;a.shaders=new Map;a.textures=new Map;a.types=new Map;return a};$jscomp.inherits(U,T);U.prototype.getExtensions=function(a){this.types.set(Float32Array,a.FLOAT);this.types.set(Uint8Array,a.UNSIGNED_BYTE);this.types.set(Uint16Array,a.UNSIGNED_SHORT);var b=a.getExtension('OES_vertex_array_object');a.createVertexArray=
b.createVertexArrayOES.bind(b);a.bindVertexArray=b.bindVertexArrayOES.bind(b)};U.prototype.onBeforeRender=function(a,b,e,f,g,k){T.prototype.onBeforeRender.call(this,a,b,e,f,g,k);b=a.getContext();void 0===b.bindVertexArray&&this.getExtensions(b);f=this.fetchOctrees();f=$jscomp.makeIterator(f.octrees);for(g=f.next();!g.done;g=f.next())g=g.value,this.renderOctree(a,g,g.visibleNodes,e);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,null);a.state.reset()};U.prototype.createBuffer=function(a,b){var d=
new Ja;d.vao=a.createVertexArray();d.numElements=b.attributes.position.count;a.bindVertexArray(d.vao);for(var e in b.attributes){var g=b.attributes[e],k=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,k);a.bufferData(a.ARRAY_BUFFER,g.array,a.STATIC_DRAW);var h=pa[e],m=g.normalized,q=this.types.get(g.array.constructor);void 0!==q&&(a.vertexAttribPointer(h,g.itemSize,q,m,0,0),a.enableVertexAttribArray(h));d.vbos.set(e,{handle:k,name:e,count:g.count,itemSize:g.itemSize,type:b.attributes.position.array.constructor,
version:0})}a.bindBuffer(a.ARRAY_BUFFER,null);a.bindVertexArray(null);return d};U.prototype.updateBuffer=function(a,b){var d=this.buffers.get(b);a.bindVertexArray(d.vao);for(var e in b.attributes){var g=b.attributes[e],k=pa[e],h=g.normalized,m=this.types.get(g.array.constructor);if(d.vbos.has(e)){var q=d.vbos.get(e).handle;d.vbos.get(e).version=g.version}else q=a.createBuffer(),d.vbos.set(e,{handle:q,name:e,count:g.count,itemSize:g.itemSize,type:b.attributes.position.array.constructor,version:g.version});
a.bindBuffer(a.ARRAY_BUFFER,q);a.bufferData(a.ARRAY_BUFFER,g.array,a.STATIC_DRAW);a.vertexAttribPointer(k,g.itemSize,m,h,0,0);a.enableVertexAttribArray(k)}a.bindBuffer(a.ARRAY_BUFFER,null);a.bindVertexArray(null)};U.prototype.fetchOctrees=function(){for(var a=[],b=[this];0<b.length;){var e=b.pop();e instanceof Y?a.push(e):(e=e.children.filter(function(a){return a.visible}),b.push.apply(b,$jscomp.arrayFromIterable(e)))}return{octrees:a}};U.prototype.renderNodes=function(a,b,e,f,g,k){a=a.getContext();
b=b.material;g=g.matrixWorldInverse;var d=new THREE.Matrix4,h=new Float32Array(16);e=$jscomp.makeIterator(e);for(var l=e.next();!l.done;l=e.next())if(l=l.value,void 0===p.debug.allowedNodes||p.debug.allowedNodes.includes(l.name)){var m=l.sceneNode.matrixWorld;d.multiplyMatrices(g,m);if(f){var x=f.offsets.get(l);k.setUniform1f('uVNStart',x)}x=l.getLevel();k.setUniform('uDebug',!0===l.debug);if(l instanceof Q)var t=0===Object.keys(l.children).length;else l instanceof R&&(t=l.geometryNode.isLeaf);k.setUniform('uIsLeafNode',
t);var G=k.uniformLocations.modelMatrix;G&&(h.set(m.elements),a.uniformMatrix4fv(G,!1,h));G=k.uniformLocations.modelViewMatrix;h.set(d.elements);a.uniformMatrix4fv(G,!1,h);if(b.clipPolygons&&0<b.clipPolygons.length){G=[];for(var v=[],y=$jscomp.makeIterator(b.clipPolygons),z=y.next();!z.done;z=y.next()){z=z.value;g=z.viewMatrix;var w=z.projMatrix.clone().multiply(g).multiply(m);G.push(z.markers.length);v.push(w)}m=[].concat.apply([],$jscomp.arrayFromIterable(v.map(function(a){return a.elements})));
y=Array(24*b.clipPolygons.length);for(v=0;v<b.clipPolygons.length;v++)for(z=b.clipPolygons[v],w=0;w<z.markers.length;w++)y[24*v+3*w]=z.markers[w].position.x,y[24*v+(3*w+1)]=z.markers[w].position.y,y[24*v+(3*w+2)]=z.markers[w].position.z;a.uniform1iv(k.uniformLocations['uClipPolygonVCount[0]'],G);a.uniformMatrix4fv(k.uniformLocations['uClipPolygonWVP[0]'],!1,m);a.uniform3fv(k.uniformLocations['uClipPolygonVertices[0]'],y)}k.setUniform1f('uLevel',x);k.setUniform1f('uNodeSpacing',l.geometryNode.estimatedSpacing);
k.setUniform1f('uPCIndex',v);l=l.geometryNode.geometry;x=null;if(this.buffers.has(l)){x=this.buffers.get(l);for(var A in l.attributes)l.attributes[A].version>x.vbos.get(A).version&&this.updateBuffer(a,l)}else x=this.createBuffer(a,l),this.buffers.set(l,x);a.bindVertexArray(x.vao);a.drawArrays(a.POINTS,0,x.numElements)}a.bindVertexArray(null)};U.prototype.renderOctree=function(a,b,e,f){var d=a.getContext(),g=b.material,h=f.matrixWorldInverse,l=f.matrixWorld,m=f.projectionMatrix,n=(new THREE.Matrix4).getInverse(m);
new THREE.Matrix4;var v=null,t=0;if(g.pointSizeType===fa.ADAPTIVE||g.pointColorType===H.LOD){v=b.computeVisibilityTextureData(e,f);var p=g.visibleNodesTexture;p.image.data.set(v.data);p.needsUpdate=!0}p=null;this.shaders.has(g)?p=this.shaders.get(g):(p=new S(d,'pointcloud',g.vertexShader,g.fragmentShader),this.shaders.set(g,p));var w=['#define num_shadowmaps0','#define num_snapshots'+(g.snapEnabled?g.numSnapshots:0),'#define num_clipboxes'+(g.clipBoxes&&g.clipBoxes.length?g.clipBoxes.length:0),'#define num_clipspheres0',
'#define num_clippolygons'+(g.clipPolygons&&g.clipPolygons.length?g.clipPolygons.length:0)].join('\n');p.update(w+'\n'+g.vertexShader,w+'\n'+g.fragmentShader);g.needsUpdate=!1;var y=$jscomp.makeIterator(Object.keys(g.uniforms));for(w=y.next();!w.done;w=y.next())if(w=g.uniforms[w.value],'t'==w.type&&(w=w.value)){if(!this.textures.has(w)){var z=new va(d,w);this.textures.set(w,z)}this.textures.get(w).update()}d.useProgram(p.program);1>g.opacity?(d.enable(d.BLEND),d.blendFunc(d.SRC_ALPHA,d.ONE),d.depthMask(!1),
d.disable(d.DEPTH_TEST)):(d.disable(d.BLEND),d.depthMask(!0),d.enable(d.DEPTH_TEST));p.setUniformMatrix4('projectionMatrix',m);p.setUniformMatrix4('viewMatrix',h);p.setUniformMatrix4('uViewInv',l);p.setUniformMatrix4('uProjInv',n);h=g.screenHeight;p.setUniform1f('uScreenWidth',g.screenWidth);p.setUniform1f('uScreenHeight',h);p.setUniform1f('fov',Math.PI*f.fov/180);p.setUniform1f('near',f.near);p.setUniform1f('far',f.far);a.capabilities.logarithmicDepthBuffer&&p.setUniform('logDepthBufFC',2/(Math.log(f.far+
1)/Math.LN2));f instanceof THREE.OrthographicCamera?(p.setUniform('uUseOrthographicCamera',!0),p.setUniform('uOrthoWidth',f.right-f.left),p.setUniform('uOrthoHeight',f.top-f.bottom)):p.setUniform('uUseOrthographicCamera',!1);0===g.clipBoxes.length+g.clipPolygons.length?p.setUniform1i('clipTask',ka.NONE):p.setUniform1i('clipTask',g.clipTask);p.setUniform1i('clipMethod',g.clipMethod);g.clipBoxes&&0<g.clipBoxes.length&&d.uniformMatrix4fv(p.uniformLocations['clipBoxes[0]'],!1,g.uniforms.clipBoxes.value);
p.setUniform1f('size',g.size);p.setUniform1f('maxSize',g.uniforms.maxSize.value);p.setUniform1f('minSize',g.uniforms.minSize.value);p.setUniform1f('uOctreeSpacing',g.spacing);p.setUniform('uOctreeSize',g.uniforms.octreeSize.value);p.setUniform3f('uColor',g.color.toArray());p.setUniform1f('uOpacity',g.opacity);p.setUniform2f('elevationRange',g.elevationRange);p.setUniform2f('intensityRange',g.intensityRange);p.setUniform1f('intensityGamma',g.intensityGamma);p.setUniform1f('intensityContrast',g.intensityContrast);
p.setUniform1f('intensityBrightness',g.intensityBrightness);p.setUniform1f('rgbGamma',g.rgbGamma);p.setUniform1f('rgbContrast',g.rgbContrast);p.setUniform1f('rgbBrightness',g.rgbBrightness);p.setUniform1f('uTransition',g.transition);p.setUniform1f('wRGB',g.weightRGB);p.setUniform1f('wIntensity',g.weightIntensity);p.setUniform1f('wElevation',g.weightElevation);p.setUniform1f('wClassification',g.weightClassification);p.setUniform1f('wReturnNumber',g.weightReturnNumber);p.setUniform1f('wSourceID',g.weightSourceID);
h=this.textures.get(g.visibleNodesTexture);p.setUniform1i('visibleNodesTexture',t);d.activeTexture(d.TEXTURE0+t);d.bindTexture(h.target,h.id);t++;h=this.textures.get(g.gradientTexture);p.setUniform1i('gradient',t);d.activeTexture(d.TEXTURE0+t);d.bindTexture(h.target,h.id);t++;h=this.textures.get(g.classificationTexture);p.setUniform1i('classificationLUT',t);d.activeTexture(d.TEXTURE0+t);d.bindTexture(h.target,h.id);t++;if(!0===g.snapEnabled){m=p.uniformLocations['uSnapshot[0]'];n=p.uniformLocations['uSnapshotDepth[0]'];
h=Array(5).fill(t).map(function(a,b){return a+b});l=Array(5).fill(1+Math.max.apply(Math,$jscomp.arrayFromIterable(h))).map(function(a,b){return a+b});t=1+Math.max.apply(Math,$jscomp.arrayFromIterable(l));d.uniform1iv(m,h);d.uniform1iv(n,l);for(t=0;5>t;t++){w=g.uniforms.uSnapshot.value[t];n=g.uniforms.uSnapshotDepth.value[t];if(!w)break;m=a.properties.get(w).__webglTexture;n=a.properties.get(n).__webglTexture;w=l[t];d.activeTexture(d['TEXTURE'+h[t]]);d.bindTexture(d.TEXTURE_2D,m);d.activeTexture(d['TEXTURE'+
w]);d.bindTexture(d.TEXTURE_2D,n)}t=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapView.value.map(function(a){return a.elements})));d.uniformMatrix4fv(p.uniformLocations['uSnapView[0]'],!1,t);t=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapProj.value.map(function(a){return a.elements})));d.uniformMatrix4fv(p.uniformLocations['uSnapProj[0]'],!1,t);t=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapProjInv.value.map(function(a){return a.elements})));d.uniformMatrix4fv(p.uniformLocations['uSnapProjInv[0]'],
!1,t);t=[].concat.apply([],$jscomp.arrayFromIterable(g.uniforms.uSnapViewInv.value.map(function(a){return a.elements})));d.uniformMatrix4fv(p.uniformLocations['uSnapViewInv[0]'],!1,t)}this.renderNodes(a,b,e,v,f,p);d.activeTexture(d.TEXTURE2);d.bindTexture(d.TEXTURE_2D,null);d.activeTexture(d.TEXTURE0)};b.AttributeLocations=pa;b.BasicGroup=T;b.BinaryHeap=qa;b.BinaryLoader=sa;b.Classification=Ia;b.ClipMethod={INSIDE_ANY:0,INSIDE_ALL:1};b.ClipTask=ka;b.DEM=ja;b.DEMNode=aa;b.EptBinaryLoader=ta;b.EptLaszipLoader=
ua;b.EptLoader=xa;b.Global=p;b.Gradients=Ha;b.GreyhoundBinaryLoader=ra;b.GreyhoundLoader=v;b.GreyhoundUtils=P;b.Group=U;b.HelperUtils=Z;b.LASLAZLoader=la;b.LASLoader=N;b.LRU=X;b.POCLoader=da;b.PointAttribute=e;b.PointAttributeNames=y;b.PointAttributeTypes=I;b.PointAttributes=g;b.PointCloudArena4D=M;b.PointCloudArena4DGeometry=ha;b.PointCloudEptGeometry=Ga;b.PointCloudGreyhoundGeometry=Ca;b.PointCloudMaterial=F;b.PointCloudOctree=B;b.PointCloudOctreeGeometry=Ea;b.PointCloudTree=Y;b.PointColorType=
H;b.PointShape=oa;b.PointSizeType=fa;b.Points=J;b.Shader=S;b.Shaders=ea;b.TreeType=na;b.VersionUtils=m;b.WebGLBuffer=Ja;b.WebGLTexture=va;b.WorkerManager=A;b.loadPointCloud=function(a,b,e){var d=function(a){void 0!==b&&(a.name=b);e({type:'pointcloud_loaded',pointcloud:a})};if(0===a.indexOf('greyhound://'))v.load(a,function(a){void 0!==a&&d(new B(a))});else if(0<a.indexOf('cloud.js'))da.load(a,function(a){void 0!==a&&d(new B(a))});else if(0<a.indexOf('ept.json'))xa.load(a,function(a){void 0!==a&&d(new B(a))});
else if(0<a.indexOf('.vpc'))ha.load(a,function(a){void 0!==a&&d(new M(a))});else throw Error('Potree: Failed to load point cloud from URL '+a);};b.updatePointClouds=ya;b.updateVisibility=wa;b.updateVisibilityStructures=za;Object.defineProperty(b,'__esModule',{value:!0})});
